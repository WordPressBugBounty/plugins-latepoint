function latepoint_is_timeframe_in_periods(e,t,a){for(var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0;i<a.length;i++){var n=0,s=0,r=0,l=0,c=a[i].split(":");if(2==c.length?(n=c[0],s=c[1]):(r=c[2],l=c[3],n=parseFloat(c[0])-parseFloat(r),s=parseFloat(c[1])+parseFloat(l)),o){if(latepoint_is_period_inside_another(e,t,n,s))return!0}else if(latepoint_is_period_overlapping(e,t,n,s))return!0}return!1}function latepoint_is_period_overlapping(e,t,a,o){return e<o&&a<t}function latepoint_is_period_inside_another(e,t,a,o){return e>=a&&t<=o}function latepoint_minutes_to_hours_preferably(e){var t=latepoint_is_army_clock(),a=Math.floor(e/60);!t&&a>12&&(a-=12);var o=e%60;return o>0&&(a=a+":"+o),a}function latepoint_minutes_to_hours(e){var t=latepoint_is_army_clock(),a=Math.floor(e/60);return!t&&a>12&&(a-=12),a}function latepoint_am_or_pm(e){return latepoint_is_army_clock()?"":e<720||1440==e?"am":"pm"}function latepoint_hours_and_minutes_to_minutes(e,t){var a=e.split(":"),o=a[0],i=a[1];return"pm"==t&&o<12&&(o=parseInt(o)+12),"am"==t&&12==o&&(o=0),i=parseInt(i)+60*o}function latepoint_get_time_system(){return latepoint_helper.time_system}function latepoint_is_army_clock(){return"24"==latepoint_get_time_system()}function latepoint_minutes_to_hours_and_minutes(e){var t=latepoint_is_army_clock(),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"%02d:%02d",o=Math.floor(e/60);return!t&&o>12&&(o-=12),t||0!=o||(o=12),e%=60,"function"==typeof sprintf?sprintf(a,o,e):`${o.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}function latepoint_generate_form_message_html(e,t){var a='<div class="os-form-message-w status-'+t+'"><ul>';return Array.isArray(e)?e.forEach((function(e){a+="<li>"+e+"</li>"})):a+="<li>"+e+"</li>",a+="</ul></div>"}function latepoint_display_in_side_sub_panel(e){jQuery(".latepoint-side-panel-w").length||latepoint_show_data_in_side_panel(""),jQuery(".latepoint-side-panel-w .latepoint-side-panels .side-sub-panel-wrapper").remove(),jQuery(".latepoint-side-panel-w .latepoint-side-panels").append(e)}function latepoint_clear_form_messages(e){e.find(".os-form-message-w").remove()}function latepoint_show_data_in_side_panel(e,t="",a=!0){jQuery(".latepoint-side-panel-w").remove(),jQuery("body").append('<div class="latepoint-side-panel-w '+t+' os-loading"><div class="latepoint-side-panel-shadow"></div><div class="latepoint-side-panels"><div class="latepoint-side-panel-i"></div></div></div>'),jQuery(".latepoint-side-panel-i").html(e),a&&(jQuery(".latepoint-side-panel-i").find(".os-form-header .latepoint-side-panel-close").remove(),jQuery(".latepoint-side-panel-i").find(".os-form-header").append('<a href="#" class="latepoint-side-panel-close latepoint-side-panel-close-trigger"><i class="latepoint-icon latepoint-icon-x"></i></a>')),setTimeout((function(){jQuery(".latepoint-side-panel-w").removeClass("os-loading")}),100)}function latepoint_show_data_in_lightbox(e,t="",a=!0,o="div",i="",n="div"){jQuery(".latepoint-lightbox-w").remove();let s="latepoint-lightbox-w latepoint-w latepoint-border-radius-"+latepoint_helper.style_border_radius+" ";t&&(s+=t);let r="latepoint-lightbox-i ";i&&(r+=i);let l=a?'<a href="#" class="latepoint-lightbox-close" tabindex="0"><i class="latepoint-icon latepoint-icon-x"></i></a>':"";jQuery("body").append("<"+o+' class="'+s+'"><'+n+' class="'+r+'">'+e+l+"</"+n+'><div class="latepoint-lightbox-shadow"></div></'+o+">"),jQuery("body").addClass("latepoint-lightbox-active")}function latepoint_add_notification(e,t="success"){var a=jQuery("body").find(".os-notifications");a.length||(jQuery("body").append('<div class="os-notifications"></div>'),a=jQuery("body").find(".os-notifications")),a.find(".item").length>0&&a.find(".item:first-child").remove(),a.append('<div class="item item-type-'+t+'">'+e+'<span class="os-notification-close"><i class="latepoint-icon latepoint-icon-x"></i></span></div>')}function latepoint_add_lightbox_notification(e,t="success"){var a=jQuery(".latepoint-lightbox-content").find(".os-notifications");a.length||(jQuery(".latepoint-lightbox-content").prepend('<div class="os-notifications"></div>'),a=jQuery(".latepoint-lightbox-content").find(".os-notifications")),a.find(".item").length>0&&a.find(".item:first-child").remove(),a.append('<div class="item item-type-'+t+'">'+e+'<span class="os-notification-close"><i class="latepoint-icon latepoint-icon-x"></i></span></div>')}function latepoint_timestamped_ajaxurl(){let e=latepoint_helper.ajaxurl,t=Date.now();return e.includes("?")?`${e}&t=${t}`:`${e}?t=${t}`}function latepoint_random_generator(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function latepoint_validate_form(e){let t=[];return e.find("select[data-os-validate], input[data-os-validate], textarea[data-os-validate]").each((function(){let e=jQuery(this).data("os-validate").split(" "),a=jQuery(this),o=a.closest(".os-form-group").find("label").text(),i=!1;if(e)for(let n=0;n<e.length;n++)switch(e[n]){case"presence":a.is(":checkbox")?a.is(":checked")||(t.push({message:o+" "+latepoint_helper.msg_validation_presence_checkbox}),i=!0):a.val()||(t.push({message:o+" "+latepoint_helper.msg_validation_presence}),i=!0);break;case"phone":window.lp_intlTelInputGlobals.getInstance(a[0]).isValidNumber()||(t.push({message:o+" "+latepoint_helper.msg_validation_invalid}),i=!0)}i?a.closest(".os-form-group").addClass("os-invalid"):a.closest(".os-form-group").removeClass("os-invalid")})),t}function latepoint_create_form_data_from_non_form_element(e){let t=new FormData,a=e.find("select, input, textarea").serializeArray();return a&&a.forEach((e=>t.append(e.name,e.value))),t}function latepoint_create_form_data(e,t=!1,a=!1){let o,i=new FormData,n=new FormData(e[0]);return a&&Object.keys(a).forEach((e=>{n.set(e,a[e])})),"lp_intlTelInputGlobals"in window&&"lp_intlTelInputUtils"in window&&e.find("input.os-mask-phone").each((function(){const e=this.getAttribute("name"),t=window.lp_intlTelInputGlobals.getInstance(this).getNumber(window.lp_intlTelInputUtils.numberFormat.E164);n.set(e,t)})),i.append("params",latepoint_formdata_to_url_encoded_string(n)),i.append("action",latepoint_helper.route_action),i.append("route_name",t||e.data("route-name")),i.append("layout","none"),i.append("return_format","json"),e.find('input[type="file"]').each((function(){o=this.files;let e=this.getAttribute("name");for(let t=0;t<o.length;t++)i.append(e+"[]",o[t])})),i}function latepoint_mask_timefield(e){jQuery().inputmask&&e.inputmask({mask:"99:99",placeholder:"HH:MM"})}function latepoint_formdata_to_url_encoded_string(e){let t=new FormData;for(const[a,o]of e)o instanceof File||("[]"===a.slice(-2)?t.append(a,o):t.set(a,o));return new URLSearchParams(t).toString()}function latepoint_mask_percent(e){jQuery().inputmask&&e.inputmask({alias:"decimal",radixPoint:latepoint_helper.decimal_separator,digits:4,digitsOptional:!1,suffix:"%",placeholder:"0",rightAlign:!1})}function latepoint_mask_minutes(e){jQuery().inputmask&&e.inputmask({removeMaskOnSubmit:!0,alias:"numeric",digits:0,suffix:latepoint_helper.msg_minutes_suffix,placeholder:"0",rightAlign:!1})}function latepoint_mask_money(e){jQuery().inputmask&&e.inputmask({alias:"currency",groupSeparator:latepoint_helper.thousand_separator,radixPoint:latepoint_helper.decimal_separator,digits:latepoint_helper.number_of_decimals,digitsOptional:!1,prefix:latepoint_helper.currency_symbol_before?latepoint_helper.currency_symbol_before+" ":"",suffix:latepoint_helper.currency_symbol_after?" "+latepoint_helper.currency_symbol_after:"",placeholder:"0",rightAlign:!1})}function latepoint_mask_date(e){jQuery().inputmask&&e.inputmask({alias:"datetime",inputFormat:latepoint_helper.date_format_for_js})}function latepoint_init_phone_masking_from_placeholder(e){if(!latepoint_helper.mask_phone_number_fields)return;let t=e.attr("placeholder");t&&jQuery().inputmask&&e.inputmask(t.replace(/[0-9]/g,9))}function latepoint_mask_phone(e){let t=e[0];if(t&&!window.lp_intlTelInputGlobals.getInstance(t)){let n=document.body,s=JSON.parse(latepoint_helper.included_phone_countries);1===s.length&&""===s[0]&&(s=[]);const r=s.length?[]:window.lp_intlTelInputGlobals.defaults.preferredCountries;for(var a=window.lp_intlTelInputGlobals.getCountryData(),o=0;o<a.length;o++){var i=a[o];i.name=i.name.replace(/ *\([^)]*\) */g,"")}let l=latepoint_helper.default_phone_country;s.length&&!s.includes(l)&&(l=s[0]),window.lp_intlTelInput(t,{dropdownContainer:n,formatOnDisplay:!0,nationalMode:!0,autoPlaceholder:"aggressive",initialCountry:l,geoIpLookup:function(e){const t="latepoint_phone_country";latepoint_has_cookie(t)?e(latepoint_get_cookie(t)):jQuery.get("https://ipinfo.io",(function(){}),"jsonp").always((function(a){let o=l;a&&a.country&&(o=a.country.toLowerCase(),latepoint_set_cookie(t,o)),e(o)}))},allowDropdown:1!=s.length,onlyCountries:s,preferredCountries:r,separateDialCode:latepoint_helper.is_enabled_show_dial_code_with_flag}).promise.then((function(){latepoint_init_phone_masking_from_placeholder(e)})),e.on("countrychange",(function(e){latepoint_init_phone_masking_from_placeholder(jQuery(this))}))}}function latepoint_show_booking_end_time(){return"yes"==latepoint_helper.show_booking_end_time}function latepoint_set_cookie(e,t,a){let o=new Date;o.setTime(o.getTime()+864e5*a),document.cookie=e+"="+t+";path=/;expires="+o.toGMTString()}function latepoint_get_cookie(e){let t=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null}function latepoint_has_cookie(e){return null!==latepoint_get_cookie(e)}function latepoint_delete_cookie(e){latepoint_set_cookie(e,"",-1)}function latepoint_load_addons_info(){var e=jQuery(".addons-info-holder");e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route"),params:"",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?t.message?e.html(t.message):e.html("Something is wrong. Try refreshing the page."):alert(t.message,"error")}})}function latepoint_dismiss_message(e){return e.closest(".addon-message").slideUp(300),!1}function latepoint_check_for_updates(){if(jQuery(".version-log-w").length){var e=jQuery(".version-log-w");e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route"),params:"",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?e.html(t.message):alert(t.message,"error")}})}if(jQuery(".version-status-info").length){var a=jQuery(".version-status-info");a.addClass("os-loading");t={action:"latepoint_route_call",route_name:a.data("route"),params:"",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(e){a.removeClass("os-loading"),"success"===e.status?a.html(e.message):alert(e.message,"error")}})}jQuery(".addons-info-holder").length&&latepoint_load_addons_info()}function latepoint_init_version5_intro(){if(jQuery(".improvement-install-pro").length){let t=jQuery(".improvement-install-pro");var e={action:latepoint_helper.route_action,route_name:t.data("route-name"),params:{},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:e,success:function(e){t.removeClass("os-loading"),"success"==e.status?t.addClass("is-installed").find("span").html(e.message):t.addClass("is-not-installed").find("span").html(e.message)}})}}function latepoint_settings_customer_authentication_method_changed(e){"password_or_otp"===e.val()?jQuery("#authDefaultMethod").show():jQuery("#authDefaultMethod").hide()}function latepoint_settings_customer_authentication_field_type_changed(e){"disabled"===e.val()?(jQuery("#passwordFields, #customerStepSettings").hide(),jQuery("#authDefaultMergeBehavior").show()):(jQuery("#passwordFields, #customerStepSettings").show(),jQuery("#authDefaultMergeBehavior").hide()),"email_or_phone"===e.val()?jQuery("#authDefaultContactType").show():jQuery("#authDefaultContactType").hide()}function latepoint_init_sticky_side_nav(){jQuery(".latepoint-page-side-nav a").on("click",(function(e){e.preventDefault();let t=jQuery(this).attr("href"),a=jQuery(t).offset().top-20;jQuery("html, body").animate({scrollTop:a},400,"swing")})),jQuery(".latepoint-page-side-nav").length&&jQuery(window).on("scroll",(function(){let e=jQuery(window).scrollTop()+100;jQuery(".section-anchor").each((function(){let t=jQuery(this).offset().top,a=t+jQuery(this).outerHeight(),o=jQuery(this).attr("id");e>=t&&e<a&&(jQuery(".latepoint-page-side-nav a").removeClass("is-active"),jQuery('.latepoint-page-side-nav a[href="#'+o+'"]').addClass("is-active"))}))}))}function latepoint_init_instant_booking_settings(){jQuery(".instant-copy-url").on("click",(function(e){e.preventDefault();let t=jQuery(this);jQuery("body").find(".os-click-to-copy-prompt").hide();let a=jQuery(".instant-visit-url").prop("href");navigator.clipboard.writeText(a);let o=t.offset(),i=o.left,n=o.top;jQuery('<div class="os-click-to-copy-done color-dark" style="top: '+n+"px; left: "+i+'px;">'+latepoint_helper.click_to_copy_done+"</div>").appendTo(jQuery("body")).animate({opacity:0,left:i+20},600),setTimeout((function(){jQuery("body").find(".os-click-to-copy-done").remove(),jQuery("body").find(".os-click-to-copy-prompt").show()}),800)})),jQuery(".instant-booking-preview-settings-content").find("select, input").on("change",(function(){latepoint_build_url_for_instant_booking_page()})),jQuery(".preview-background-option").on("click",(function(e){jQuery(".preview-background-option").removeClass("selected"),jQuery(this).addClass("selected"),jQuery('input[name="instant_booking[background_pattern]"]').val(jQuery(this).data("pattern-key")).trigger("change")})),jQuery(".latepoint-instant-preview-close-trigger").on("click",(function(e){return jQuery(".latepoint-full-panel-w").remove(),!1}))}async function latepoint_build_url_for_instant_booking_page(){let e={action:"latepoint_route_call",route_name:jQuery(".instant-booking-preview-settings-content").data("route-name"),params:jQuery(".instant-booking-preview-settings-content").find("select, input").serialize(),layout:"none",return_format:"json"};try{let t=await jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:e});if("success"!=t.status)throw new Error("Error: "+t.message);jQuery(".instant-booking-settings-iframe-wrapper").html('<iframe class="instant-preview-iframe" src="'+t.message+'"/>'),jQuery(".instant-visit-url").attr("href",t.message)}catch(e){throw e}}function latepoint_build_and_save_step_order(){var e=jQuery(".os-ordered-steps");let t=[];e.find(".os-ordered-step").each((function(e){jQuery(this).find(".os-ordered-step-children").length?jQuery(this).find(".os-ordered-step-child").each((function(){t.push(jQuery(this).data("step-code"))})):t.push(jQuery(this).data("step-code"))}));var a={action:latepoint_helper.route_action,route_name:e.data("route-name"),params:{steps_order:t.join(",")},return_format:"json"};jQuery(".latepoint-lightbox-heading").addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(e){jQuery(".latepoint-lightbox-heading").removeClass("os-loading"),latepoint_add_lightbox_notification(e.message,e.status)}})}function latepoint_init_step_reordering(){jQuery(".os-ordered-step-expand").on("click",(function(){return jQuery(this).closest(".os-ordered-step").toggleClass("is-expanded"),!1})),dragula([jQuery(".os-ordered-steps")[0]],{moves:function(e,t,a){return a.classList.contains("os-ordered-step-drag-handle")}}).on("drop",(function(e){latepoint_build_and_save_step_order()})),jQuery(".os-ordered-step-children").each((function(){let e=jQuery(this);dragula([e[0]],{moves:function(e,t,a){return a.classList.contains("os-ordered-step-child-drag-handle")}}).on("drop",(function(e){latepoint_build_and_save_step_order()}))}))}function latepoint_init_json_view(e=!1){e||(e=jQuery("pre.format-json:not(.json-document)")),e.length&&e.each((function(){let e=JSON.parse(jQuery(this).html());jQuery(this).jsonViewer(e)}))}function latepoint_init_accordions(){jQuery(".latepoint-admin").on("click",".os-accordion-title",(function(){return jQuery(this).closest(".os-accordion-wrapper").toggleClass("is-open"),!1}))}function latepoint_init_sticky_side_menu(){jQuery(".os-sticky-side-menu a").on("click",(function(){jQuery(".os-sticky-side-menu li.os-active").removeClass("os-active"),jQuery(this).closest("li").addClass("os-active");let e=jQuery(this).data("section-anchor"),t=jQuery(".section-anchor#"+e).offset();return jQuery("html").animate({scrollTop:t.top},300),!1}))}function latepoint_init_template_library(){jQuery(".os-templates-wrapper .template-type-selector").on("click",(function(){jQuery(this).toggleClass("is-selected");let e=jQuery(this).data("user-type");return jQuery('.os-template-items[data-user-type="'+e+'"]').toggleClass("hidden"),!1})),jQuery(".os-templates-wrapper .os-template-item").on("click",(function(){let e=jQuery(this);e.closest(".os-templates-list").find(".os-template-item.selected").removeClass("selected"),e.addClass("selected");let t=e.data("id");return jQuery(".os-template-preview").hide(),jQuery('.os-template-preview[data-id="'+t+'"]').show(),jQuery(".os-no-template-selected-message").hide(),jQuery(".os-template-use-button-wrapper").removeClass("hidden"),!1})),jQuery(".latepoint-select-template-btn").on("click",(function(){let e=jQuery(this),t=e.data("route"),a=e.data("action-id"),o=e.data("process-id"),i=e.data("action-type");e.addClass("os-loading");let n={action:latepoint_helper.route_action,route_name:t,params:{template_id:jQuery(".os-template-item.selected").data("id"),action_id:a,process_id:o,action_type:i},return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:t=>{if(e.removeClass("os-loading"),t.status===latepoint_helper.response_status.success){let e=jQuery('.process-action-form[data-id="'+a+'"]');e.find(".process-action-settings").html(t.message),latepoint_init_process_action_form(e),latepoint_close_side_panel()}else alert("Error!")}}),!1}))}function latepoint_init_default_form_fields_settings(){jQuery(".os-default-fields").length&&(jQuery('.os-default-field input[type="checkbox"], .os-default-field select').on("change",(e=>{latepoint_update_default_form_fields_settings()})),jQuery(".os-default-field .os-toggler").on("ostoggler:toggle",(e=>{jQuery(e.currentTarget).hasClass("off")?jQuery(e.currentTarget).closest(".os-default-field").addClass("is-disabled"):jQuery(e.currentTarget).closest(".os-default-field").removeClass("is-disabled"),latepoint_update_default_form_fields_settings()})))}function latepoint_update_default_form_fields_settings(){var e=jQuery(".os-default-fields"),t=new FormData(e.find("form")[0]),a={action:latepoint_helper.route_action,route_name:e.data("route"),params:latepoint_formdata_to_url_encoded_string(t),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:e=>{latepoint_add_notification(e.message)}})}function latepoint_init_side_menu(){jQuery(".menu-toggler").on("click",(function(){let e="full";jQuery(".latepoint-side-menu-w").hasClass("side-menu-full")?(e="compact",jQuery(".latepoint-side-menu-w").addClass("side-menu-compact").removeClass("side-menu-full")):jQuery(".latepoint-side-menu-w").addClass("side-menu-full").removeClass("side-menu-compact");let t=jQuery(this).data("route"),a={action:latepoint_helper.route_action,route_name:t,params:{menu_layout_style:e},layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(e){}}),!1}))}function latepoint_init_grouped_bookings_form(){}function latepoint_quick_order_customer_cleared(){latepoint_init_input_masks(jQuery(".quick-order-form-w .customer-quick-edit-form-w"))}function latepoint_quick_order_customer_selected(){latepoint_init_input_masks(jQuery(".quick-order-form-w .customer-quick-edit-form-w")),jQuery(".customer-info-w").removeClass("selecting").addClass("selected")}function latepoint_custom_day_removed(e){e.closest(".custom-day-work-period").fadeOut(300,(function(){jQuery(this).remove()}))}function latepoint_count_active_connections(e){var t=e.find(".connection-children-list li.active").length,a=e.find(".connection-children-list li").length;t==a?(t=jQuery(".selected-connections").data("all-text"),jQuery(".selected-connections").removeClass("not-all-selected")):(t=t+"/"+a,jQuery(".selected-connections").addClass("not-all-selected"),e.closest(".white-box").find(".os-select-all-toggler").prop("checked",!1)),e.find(".selected-connections strong").text(t)}function latepoint_custom_field_removed(e){e.closest(".os-form-block").remove()}function latepoint_coupon_removed(e){e.closest(".os-coupon-form").remove()}function latepoint_reminder_removed(e){e.closest(".os-reminder-form").remove()}function latepoint_init_form_blocks(){jQuery(".latepoint-content-w").on("click",".os-form-block-header",(function(){return jQuery(this).closest(".os-form-block").toggleClass("os-is-editing"),!1})),jQuery(".latepoint-content-w").on("keyup",".os-form-block-name-input",(function(){jQuery(this).closest(".os-form-block").find(".os-form-block-name").text(jQuery(this).val())}))}function latepoint_init_coupons_form(){jQuery(".latepoint-content-w").on("click",".os-coupon-form-info",(function(){return jQuery(this).closest(".os-coupon-form").toggleClass("os-is-editing"),!1})),jQuery(".latepoint-content-w").on("change","select.os-coupon-medium-select",(function(){"email"==jQuery(this).val()?jQuery(this).closest(".os-coupon-form").find(".os-coupon-email-subject").show():jQuery(this).closest(".os-coupon-form").find(".os-coupon-email-subject").hide()})),jQuery(".latepoint-content-w").on("keyup",".os-coupon-name-input",(function(){jQuery(this).closest(".os-coupon-form").find(".os-coupon-name").text(jQuery(this).val())})),jQuery(".latepoint-content-w").on("keyup",".os-coupon-code-input",(function(){jQuery(this).closest(".os-coupon-form").find(".os-coupon-code").text(jQuery(this).val())}))}function latepoint_init_reminders_form(){jQuery(".latepoint-content-w").on("click",".os-reminder-form-info",(function(){return jQuery(this).closest(".os-reminder-form").toggleClass("os-is-editing"),!1})),jQuery(".latepoint-content-w").on("change","select.os-reminder-medium-select",(function(){"email"==jQuery(this).val()?jQuery(this).closest(".os-reminder-form").find(".os-reminder-email-subject").show():jQuery(this).closest(".os-reminder-form").find(".os-reminder-email-subject").hide()})),jQuery(".latepoint-content-w").on("keyup",".os-reminder-name-input",(function(){jQuery(this).closest(".os-reminder-form").find(".os-reminder-name").text(jQuery(this).val())}))}function latepoint_custom_field_saved(e){}function latepoint_init_custom_day_schedule(){latepoint_init_input_masks(jQuery(".latepoint-lightbox-w .custom-day-schedule-w")),jQuery(".period-type-selector").on("change",(function(){jQuery(this).closest(".custom-day-calendar").attr("data-period-type",jQuery(this).val()),jQuery(".custom-day-calendar").attr("data-picking","start").data("picking","start"),"range"==jQuery(this).val()?(jQuery(".custom-day-calendar-head .calendar-heading").text(jQuery(".custom-day-calendar-head .calendar-heading").data("label-start")),jQuery(".custom-day-calendar #start_custom_date").trigger("focus")):(jQuery(".custom-day-calendar .os-day.selected").removeClass("selected"),jQuery(".latepoint-lightbox-footer").hide(),jQuery(".custom-day-calendar-head .calendar-heading").text(jQuery(".custom-day-calendar-head .calendar-heading").data("label-single")))})),jQuery("#custom_day_calendar_month, #custom_day_calendar_year").on("change",(function(){var e=jQuery(".custom-day-calendar-month"),t=e.data("route");e.addClass("os-loading");var a=jQuery("#custom_day_calendar_year").val()+"-"+jQuery("#custom_day_calendar_month").val()+"-01",o={action:latepoint_helper.route_action,route_name:t,params:{target_date_string:a},layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:function(t){e.removeClass("os-loading"),"success"===t.status&&e.html(t.message)}})})),jQuery(".custom-day-calendar").on("focus","#start_custom_date",(function(){jQuery(".custom-day-calendar-head .calendar-heading").text(jQuery(".custom-day-calendar-head .calendar-heading").data("label-start")),jQuery(".custom-day-calendar").attr("data-picking","start").data("picking","start")})),jQuery(".custom-day-calendar").on("focus","#end_custom_date",(function(){jQuery(".custom-day-calendar-head .calendar-heading").text(jQuery(".custom-day-calendar-head .calendar-heading").data("label-end")),jQuery(".custom-day-calendar").attr("data-picking","end").data("picking","end")})),jQuery(".custom-day-calendar").on("click",".os-day",(function(){var e=jQuery(this);if(e.closest(".custom-day-calendar").find(".os-day.selected").removeClass("selected"),e.addClass("selected"),"start"==jQuery(".custom-day-calendar").data("picking")){if(jQuery(".custom-day-settings-w #start_custom_date").val(e.data("date")).trigger("keyup"),"range"==jQuery(".period-type-selector").val()&&(jQuery(".custom-day-calendar #end_custom_date").trigger("focus"),!jQuery(".custom-day-calendar #end_custom_date").val()))return!1}else jQuery(".custom-day-settings-w #end_custom_date").val(e.data("date")).trigger("keyup");return jQuery(".latepoint-lightbox-footer").slideDown(200),"yes"==jQuery(".custom-day-calendar").data("show-schedule")&&jQuery(".latepoint-lightbox-w").removeClass("hide-schedule"),!1}))}function latepoint_init_updates_page(){}function latepoint_calendar_set_month_label(){jQuery(".os-current-month-label .current-month").text(jQuery(".os-monthly-calendar-days-w.active").data("calendar-month-label")),jQuery(".os-current-month-label .current-year").text(jQuery(".os-monthly-calendar-days-w.active").data("calendar-year"))}function latepoint_init_element_togglers(){jQuery("[data-toggle-element]").on("click",(function(){var e=jQuery(this);e.closest(".os-form-checkbox-group").toggleClass("is-checked"),jQuery(e.data("toggle-element")).toggle()}))}function latepoint_init_color_picker(){jQuery(".latepoint-color-picker").length&&jQuery(".latepoint-color-picker").each((function(){var e=jQuery(this).data("color"),t=jQuery(this)[0],a=jQuery(this).closest(".latepoint-color-picker-w");Pickr.create({el:t,default:e,comparison:!1,useAsButton:!0,components:{preview:!1,opacity:!1,hue:!0,interaction:{input:!1,clear:!1,save:!0}},onChange(e,t){a.find(".os-form-control").val(e.toHEX().toString())}})}))}function latepoint_lightbox_close(){jQuery("body").removeClass("latepoint-lightbox-active"),jQuery(".latepoint-lightbox-w").remove()}function latepoint_reload_select_service_categories(){jQuery(".service-selector-adder-field-w").each((function(){var e=jQuery(this),t=jQuery(".service-selector-adder-field-w").find("select").data("select-source"),a={action:latepoint_helper.route_action,route_name:t,params:"",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_lightbox_close(),e.find("select").html(t.message),e.find("select option:last").attr("selected","selected")):alert(t.message,"error")}})}))}function latepoint_wizard_item_editing_cancelled(e){jQuery(".os-wizard-setup-w").removeClass("is-sub-editing"),jQuery(".os-wizard-footer").show(),jQuery(".os-wizard-footer .os-wizard-next-btn").show(),e.show_prev_btn&&jQuery(".os-wizard-footer .os-wizard-prev-btn").show()}function latepoint_reload_week_view_calendar(e=!1){var t="on"==jQuery(".cc-availability-toggler #overlay_service_availability").val()&&jQuery(".calendar-service-selector").val(),a=jQuery(".calendar-agent-selector").val(),o=jQuery(".calendar-location-selector").val();latepoint_load_calendar(e||jQuery(".calendar-start-date").val(),a,o,t)}function latepoint_init_work_period_form(){latepoint_mask_timefield(jQuery(".os-time-input-w .os-mask-time"))}function latepoint_close_side_panel(){latepoint_close_quick_availability_form(),jQuery(".latepoint-side-panel-w").remove()}function reload_process_jobs_table(){jQuery("table.os-reload-on-booking-update").length&&latepoint_filter_table(jQuery("table.os-reload-on-booking-update"),jQuery("table.os-reload-on-booking-update"))}function latepoint_transaction_removed(e){e.closest(".quick-add-transaction-box-w").remove(),latepoint_reload_balance_and_payments()}function latepoint_reload_widget(e){var t=e.find("select, input").serialize(),a={action:latepoint_helper.route_action,route_name:e.data("os-reload-action"),params:t,return_format:"json"};e.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){if(e.removeClass("os-loading"),"success"===t.status){var a=jQuery(t.message);a.removeClass("os-widget-animated"),e=e.replaceWith(a),latepoint_init_daterangepicker(a.find(".os-date-range-picker")),e.hasClass("os-widget-top-agents")&&latepoint_init_circles_charts(),e.hasClass("os-widget-daily-bookings")&&(latepoint_init_daily_bookings_chart(),latepoint_init_donut_charts())}else alert(t.message)}})}function latepoint_load_calendar(e,t,a=!1,o=!1){var i=jQuery(".calendar-week-agent-w").data("calendar-action");jQuery(".calendar-week-agent-w").addClass("os-loading");var n={target_date:e,agent_id:t};a&&(n.location_id=a),o&&(n.service_id=o);var s={action:latepoint_helper.route_action,route_name:i,params:jQuery.param(n),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:s,success:function(e){"success"===e.status?(jQuery(".calendar-week-agent-w").html(e.message).removeClass("os-loading"),jQuery(".calendar-load-target-date.os-loading").removeClass("os-loading")):alert(e.message)}})}function latepoint_init_quick_transaction_form(){latepoint_mask_money(jQuery(".quick-add-transaction-box-w .os-mask-money"))}function latepoint_reload_price_breakdown(){var e=jQuery(".reload-price-breakdown");e.addClass("os-loading");var t=e.closest("form.order-quick-edit-form"),a=new FormData(t[0]),o=e.data("route"),i={action:latepoint_helper.route_action,route_name:o,params:latepoint_formdata_to_url_encoded_string(a),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:i,success:function(t){e.removeClass("os-loading"),"success"===t.status?(jQuery(".price-breakdown-wrapper").html(t.message),latepoint_mask_money(jQuery(".price-breakdown-wrapper .os-mask-money")),latepoint_reload_balance_and_payments()):alert(t.message)}})}function latepoint_complex_selector_select(e,t=1){e.each((function(){jQuery(this).addClass("active"),jQuery(this).find(".connection-children-list li").addClass("active"),jQuery(this).find(".connection-child-is-connected").val("yes"),jQuery(this).find(".item-quantity-selector-input").val(t),latepoint_count_active_connections(jQuery(this))}))}function latepoint_complex_selector_deselect(e){e.each((function(){jQuery(this).removeClass("active"),jQuery(this).removeClass("show-customize-box"),jQuery(this).find(".connection-children-list li.active").removeClass("active"),jQuery(this).find(".connection-child-is-connected").val("no"),jQuery(this).find(".item-quantity-selector-input").val(0),latepoint_count_active_connections(jQuery(this))}))}function latepoint_is_next_day(e){let t="order_items["+e.data("order-item-id")+"][bookings]["+e.data("booking-id")+"]"
;var a=latepoint_hours_and_minutes_to_minutes(e.find('input[name="'+t+'[start_time][formatted_value]"]').val(),e.find('input[name="'+t+'[start_time][ampm]"]').val()),o=latepoint_hours_and_minutes_to_minutes(e.find('input[name="'+t+'[end_time][formatted_value]"]').val(),e.find('input[name="'+t+'[end_time][ampm]"]').val());o&&o<=a?e.find(".quick-end-time-w").addClass("ending-next-day"):e.find(".quick-end-time-w").removeClass("ending-next-day")}function latepoint_set_booking_end_time(e){var t=0,a=Number(e.find(".os-service-durations select").val());let o="order_items["+e.data("order-item-id")+"][bookings]["+e.data("booking-id")+"]";t+=a,e.find('select[name="temp_service_extras_ids"] option:selected').length&&e.find('select[name="temp_service_extras_ids"] option:selected').each((function(){var e=Number(jQuery(this).data("duration")),a=jQuery(this).closest(".lateselect-w").find('.ls-item[data-value="'+jQuery(this).val()+'"]').find(".os-late-quantity-selector-input");a.length&&(e=Number(e)*Number(a.val())),t=Number(t)+Number(e)}));var i=e.find('input[name="'+o+'[start_time][formatted_value]"]').val();if(i){var n=latepoint_hours_and_minutes_to_minutes(i,e.find('input[name="'+o+'[start_time][ampm]"]').val()),s=parseInt(n)+parseInt(t);s>=1440&&(s-=1440);var r=s>=720&&s<1440?"pm":"am",l=latepoint_minutes_to_hours_and_minutes(s);e.find('input[name="'+o+'[end_time][formatted_value]"]').val(l),e.find(".quick-end-time-w .time-ampm-select.time-"+r).trigger("click"),e.find('input[name="'+o+'[end_time][formatted_value]"]').closest(".os-form-group").addClass("has-value")}latepoint_is_next_day(e)}function latepoint_init_sortable_columns(){jQuery(".os-sortable-column").on("click",(function(){let e="desc"==(jQuery(this).hasClass("ordered-desc")?"desc":"asc")?"asc":"desc";return jQuery(this).closest("table").find(".os-sortable-column").removeClass("ordered-desc").removeClass("ordered-asc"),jQuery(this).addClass("ordered-"+e),jQuery(this).closest("table").find(".records-ordered-by-key").val(jQuery(this).data("order-key")),jQuery(this).closest("table").find(".records-ordered-by-direction").val(e),latepoint_filter_table(jQuery(this).closest("table"),jQuery(this).closest(".os-form-group")),!1}))}function latepoint_random_text(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=a.length,i=0;i<e;i++)t+=a.charAt(Math.floor(Math.random()*o));return t}function latepoint_get_order_for_service_categories(){}function latepoint_init_daterangepicker(e){e.each((function(){var e=jQuery(this).find('input[name="date_from"], .os-datepicker-date-from').val(),t=jQuery(this).find('input[name="date_to"], .os-datepicker-date-to').val(),a={};jQuery(this).data("can-be-cleared")&&(a={cancelLabel:jQuery(this).data("clear-btn-label")}),moment.locale(latepoint_helper.wp_locale),jQuery(this).daterangepicker({opens:"center",singleDatePicker:"yes"==jQuery(this).data("single-date"),startDate:e?moment(e):moment(),endDate:t?moment(t):moment(),locale:a})})),e.on("cancel.daterangepicker",(function(e,t){t.element.data("can-be-cleared")&&(t.element.find('input[name="date_from"], .os-datepicker-date-from').val(""),t.element.find('input[name="date_to"], .os-datepicker-date-to').val(""),t.element.find("span.range-picker-value").text(t.element.data("no-value-label")),t.element.hasClass("os-table-filter-datepicker")&&latepoint_filter_table(t.element.closest("table"),t.element.closest(".os-form-group")))})),e.on("apply.daterangepicker",(function(e,t){"yes"==t.element.data("single-date")?t.element.find(".range-picker-value").text(t.startDate.format("ll")):t.element.find(".range-picker-value").text(t.startDate.format("ll")+" - "+t.endDate.format("ll")),t.element.find('input[name="date_from"], .os-datepicker-date-from').attr("value",t.startDate.format("YYYY-MM-DD")),t.element.find('input[name="date_to"], .os-datepicker-date-to').attr("value",t.endDate.format("YYYY-MM-DD")),t.element.closest(".os-widget").length&&latepoint_reload_widget(t.element.closest(".os-widget")),t.element.hasClass("os-table-filter-datepicker")&&latepoint_filter_table(t.element.closest("table"),t.element.closest(".os-form-group"))}))}function latepoint_recalculate_items_count_in_category(){jQuery(".os-category-items-count").each((function(){var e=jQuery(this).closest(".os-category-parent-w").find(".item-in-category-w").length;jQuery(this).find("span").text(e)}))}function latepoint_remove_agent_box(e){e.closest(".agent-box-w").fadeOut(300,(function(){jQuery(this).remove()}))}function latepoint_remove_service_box(e){e.closest(".service-box-w").fadeOut(300,(function(){jQuery(this).remove()}))}function latepoint_init_monthly_view(){jQuery(".calendar-month-agents-w").length&&jQuery(".monthly-calendar-headers select").on("change",(function(){var e=jQuery(".calendar-month-agents-w"),t=e.data("route");e.addClass("os-loading");var a={month:jQuery("#monthly_calendar_month_select").val(),year:jQuery("#monthly_calendar_year_select").val()};jQuery("#monthly_calendar_location_select").length&&jQuery("#monthly_calendar_location_select").val()&&(a.location_id=jQuery("#monthly_calendar_location_select").val()),jQuery("#monthly_calendar_service_select").length&&jQuery("#monthly_calendar_service_select").val()&&(a.service_id=jQuery("#monthly_calendar_service_select").val());var o={action:latepoint_helper.route_action,route_name:t,params:a,layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:function(t){e.removeClass("os-loading"),"success"===t.status&&e.html(t.message)}})}))}function latepoint_init_copy_on_click_elements(){jQuery(".os-click-to-copy").on("mouseenter",(function(){var e=jQuery(this),t=e.offset(),a=jQuery(this).outerWidth(),o=t.left,i=t.top-20-jQuery(window).scrollTop();let n="dark"==e.data("copy-tooltip-color")?"dark":"light";"left"==e.data("copy-tooltip-position")&&(o=o-a-5,i=i+e.outerHeight()-jQuery(window).scrollTop()),jQuery("body").append('<div class="os-click-to-copy-prompt color-'+n+'" style="top: '+i+"px; left: "+o+'px;">'+latepoint_helper.click_to_copy_prompt+"</div>")})).on("mouseleave",(function(){jQuery("body").find(".os-click-to-copy-prompt").remove()})),jQuery(".os-click-to-copy").on("click",(function(){var e=jQuery(this);let t="dark"==e.data("copy-tooltip-color")?"dark":"light";jQuery("body").find(".os-click-to-copy-prompt").hide();var a=e.is("input")?e.val():e.text();navigator.clipboard.writeText(a);var o=e.offset(),i=e.outerWidth(),n=o.left,s=o.top-20-jQuery(window).scrollTop();"left"==e.data("copy-tooltip-position")&&(n=n-i-5,s=s+e.outerHeight()-jQuery(window).scrollTop()),jQuery('<div class="os-click-to-copy-done color-'+t+'" style="top: '+s+"px; left: "+n+'px;">'+latepoint_helper.click_to_copy_done+"</div>").appendTo(jQuery("body")).animate({opacity:0,left:n+20},600),setTimeout((function(){jQuery("body").find(".os-click-to-copy-done").remove(),jQuery("body").find(".os-click-to-copy-prompt").show()}),800)}))}function latepoint_remove_floating_popup(){jQuery(".os-showing-popup").removeClass("os-showing-popup"),jQuery(".os-floating-popup").remove()}function latepoint_init_clickable_cells(){jQuery(".os-clickable-popup-trigger").on("click",(function(){var e=jQuery(this),t=e.offset(),a=e.outerWidth(),o=jQuery('<div class="os-floating-popup os-loading"></div>');if(e.hasClass("os-showing-popup"))latepoint_remove_floating_popup();else{latepoint_remove_floating_popup(),o.offset({top:t.top,left:t.left+a/2}),jQuery("body").append(o),e.addClass("os-showing-popup");var i=e.data("route"),n=e.data("os-params"),s={action:latepoint_helper.route_action,route_name:i,params:n,layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:s,success:function(e){e.status===latepoint_helper.response_status.success&&(jQuery("body").find(".os-floating-popup").html(e.message).removeClass("os-loading"),latepoint_init_customer_donut_chart(),jQuery(".os-floating-popup .os-floating-popup-close").on("click",(function(){return latepoint_remove_floating_popup(),!1})))}})}return!1}))}function latepoint_init_tiny_mce(e){"undefined"!=typeof wp&&void 0!==wp.editor&&jQuery("#"+e).length&&(wp.editor.remove(e),wp.editor.initialize(e,{tinymce:{wpautop:!1,toolbar1:"formatselect alignjustify forecolor | bold italic underline strikethrough | bullist numlist | blockquote hr | alignleft aligncenter alignright | link unlink | pastetext removeformat | outdent indent | undo redo",height:"480"},quicktags:!0,mediaButtons:!0}))}function latepoint_init_reminder_form(){latepoint_init_tiny_mce(jQuery(".os-reminder-form:last-child textarea").attr("id"))}function latepoint_filter_table(e,t,a=!0){t.addClass("os-loading");var o=e.find(".os-table-filter").serialize(),i=e.closest(".table-with-pagination-w");a?i.find("select.pagination-page-select").val(1):o+="&page_number="+i.find("select.pagination-page-select").val();var n=e.data("route"),s={action:latepoint_helper.route_action,route_name:n,params:o,layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:s,success:function(o){if(t.removeClass("os-loading"),"success"===o.status){if(e.find("tbody").html(o.message),o.total_pages&&a){for(var n="",s=1;s<=o.total_pages;s++)n+="<option>"+s+"</option>";i.find("select.pagination-page-select").html(n)}i.find(".os-pagination-from").text(o.showing_from),i.find(".os-pagination-to").text(o.showing_to),i.find(".os-pagination-total").text(o.total_records),latepoint_init_clickable_cells()}}})}function latepoint_init_service_duration_box(e){latepoint_init_input_masks(jQuery(".service-duration-box:last-child"))}function latepoint_init_wizard_content(){latepoint_init_input_masks(jQuery(".os-wizard-step-content"))}function latepoint_init_input_masks(e=!1){let t=e||jQuery("body");latepoint_mask_timefield(t.find(".os-mask-time")),t.find(".os-mask-phone").each((function(){latepoint_mask_phone(jQuery(this))})),latepoint_mask_money(t.find(".os-mask-money")),latepoint_mask_date(t.find(".os-mask-date")),latepoint_mask_minutes(t.find(".os-mask-minutes")),t.trigger("latepoint:initInputMasks")}function latepoint_init_quick_agent_form(){let e=jQuery(".quick-agent-form-w");latepoint_init_input_masks(e),e.find(".agent-quick-edit-form").on("submit",(function(e){if(jQuery(this).find('button[type="submit"]').hasClass("os-loading"))return!1;e.preventDefault(),latepoint_submit_quick_agent_form()})),e.find(".quick-agent-form-view-log-btn").on("click",(function(){let e=jQuery(this);e.addClass("os-loading");let t={action:"latepoint_route_call",route_name:e.data("route"),params:{agent_id:e.data("agent-id")},return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_display_in_side_sub_panel(t.message),jQuery("body").addClass("has-side-sub-panel")):alert(t.message,"error")}}),!1}))}function latepoint_init_quick_customer_form(){let e=jQuery(".quick-customer-form-w");latepoint_init_input_masks(e),e.find(".customer-quick-edit-form").on("submit",(function(e){if(jQuery(this).find('button[type="submit"]').hasClass("os-loading"))return!1;e.preventDefault(),latepoint_submit_quick_customer_form()})),e.find(".quick-customer-form-view-log-btn").on("click",(function(){var e=jQuery(this);e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route"),params:{customer_id:e.data("customer-id")},return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_display_in_side_sub_panel(t.message),jQuery("body").addClass("has-side-sub-panel")):alert(t.message,"error")}}),!1}))}function latepoint_submit_quick_customer_form(){let e=jQuery("form.customer-quick-edit-form"),t=latepoint_validate_form(e);if(t.length){return latepoint_add_notification(t.map((e=>e.message)).join(", "),"error"),!1}e.find('button[type="submit"]').addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:latepoint_create_form_data(e),success:function(t){e.find('button[type="submit"]').removeClass("os-loading"),t.form_values_to_update&&jQuery.each(t.form_values_to_update,(function(t,a){e.find('[name="'+t+'"]').val(a)})),"success"===t.status?(latepoint_add_notification(t.message),latepoint_reload_after_customer_save()):latepoint_add_notification(t.message,"error")}})}function latepoint_reload_after_customer_save(){latepoint_reload_calendar_view(),jQuery(".os-widget").each((function(){latepoint_reload_widget(jQuery(this))})),jQuery("table.os-reload-on-booking-update").length&&latepoint_filter_table(jQuery("table.os-reload-on-booking-update"),jQuery("table.os-reload-on-booking-update")),latepoint_close_side_panel()}function latepoint_init_customers_import(){jQuery("body.latepoint").on("submit",".import-customers-form",(async function(e){e.preventDefault();let t=jQuery(this);if(t.hasClass("os-loading"))return!1;t.addClass("os-loading"),t.find('button[type="submit"]').addClass("os-loading");try{let e=await jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:latepoint_create_form_data(t)});if(t.removeClass("os-loading").find(".os-loading").removeClass("os-loading"),"success"!==e.status)return latepoint_add_notification(e.message||"Error","error"),!1;t.find(".latepoint-lightbox-content").html(e.message),latepoint_import_customers_set_next_btn(t),latepoint_import_customers_set_step(t)}catch(e){t.removeClass("os-loading").find(".os-loading").removeClass("os-loading"),console.log(e)}}))}function latepoint_import_customers_set_next_btn(e){let t=e.find(".customer-csv-step");if(t.data("hide-next-btn"))e.find(".latepoint-lightbox-footer").hide();else{let a=t.data("customer-csv-next-btn");a&&e.find(".latepoint-csv-next-btn").text(a)}}function latepoint_import_customers_set_step(e){let t=e.find(".customer-csv-step").data("customer-csv-step");t&&e.find('input[name="step"]').val(t)}function latepoint_init_daily_bookings_chart(){if("undefined"==typeof Chart||!jQuery("#chartDailyBookings").length)return;let e=jQuery("#chartDailyBookings"),t=e.data("chart-labels").toString().split(","),a=e.data("chart-values").toString().split(",").map(Number),o=Math.max.apply(Math,a),i=o+160*o/200+1;var n=latepoint_helper.body_font_family;Chart.Tooltip.positioners.top=function(e){const t=Chart.Tooltip.positioners.average(e);if(!1===t)return!1;const a=this.chart;return{x:t.x,y:a.chartArea.top,xAlign:"center",yAlign:"bottom"}},Chart.defaults.defaultFontFamily=n,Chart.defaults.defaultFontSize=18,Chart.defaults.defaultFontStyle="400",Chart.defaults.plugins.tooltip.titleFont={family:n,size:14,color:"rgba(255,255,255,0.6)",style:"normal",weight:400},Chart.defaults.plugins.tooltip.titleFont={family:n,size:14,weight:400},Chart.defaults.plugins.tooltip.titleColor="rgba(255,255,255,0.6)",Chart.defaults.plugins.tooltip.backgroundColor="#000",Chart.defaults.plugins.tooltip.titleMarginBottom=5,Chart.defaults.plugins.tooltip.bodyFont={family:n,size:24,weight:700,lineHeight:.8},Chart.defaults.plugins.tooltip.displayColors=!1,Chart.defaults.plugins.tooltip.padding=10,Chart.defaults.plugins.tooltip.yAlign="bottom",Chart.defaults.plugins.tooltip.xAlign="center",Chart.defaults.plugins.tooltip.cornerRadius=14,Chart.defaults.plugins.tooltip.caretSize=5,Chart.defaults.plugins.tooltip.position="top";var s=e[0].getContext("2d"),r=s.createLinearGradient(500,0,100,0);r.addColorStop(0,"#219ff8"),r.addColorStop(1,"#219ff8");let l=s.createLinearGradient(0,0,0,140);l.addColorStop(0,"rgba(195, 229, 253, 0.9)"),l.addColorStop(1,"rgba(195, 229, 253, 0.1)");new Chart(e,{type:"line",data:{labels:t,datasets:[{backgroundColor:l,borderColor:r,label:"",fill:!0,lineTension:.3,borderWidth:2,borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"#fff",pointBackgroundColor:"#219ff8",pointRadius:3,pointBorderWidth:2,pointHoverRadius:6,pointHoverBorderWidth:4,pointHoverBackgroundColor:"#219ff8",pointHoverBorderColor:"#fff",pointHitRadius:20,spanGaps:!1,data:a}]},options:{animation:!1,layout:{padding:{top:0}},interaction:{mode:"index",intersect:!1},maintainAspectRatio:!1,plugins:{verticalLiner:{},legend:{display:!1}},scales:{x:{display:!0,ticks:{fontFamily:n,maxRotation:0,color:"#788291",font:{size:10,family:n},callback:function(e,t,a){return a.length&&(t+2)%Math.round(a.length/8)?"":this.getLabelForValue(e)}},grid:{borderDash:[1,5],color:"rgba(0,0,0,0.35)",zeroLineColor:"rgba(0,0,0,0.15)"}},y:{max:i,grid:{color:"rgba(0,0,0,0.05)",zeroLineColor:"rgba(0,0,0,0.05)"},display:!1,ticks:{beginAtZero:!0,fontSize:"10",fontColor:"#000"}}}},plugins:[{id:"verticalLiner",afterInit:(e,t,a)=>{e.verticalLiner={}},afterEvent:(e,t,a)=>{const{inChartArea:o}=t;e.verticalLiner={draw:o}},beforeTooltipDraw:(e,t,a)=>{const{draw:o}=e.verticalLiner;if(!o)return;const{ctx:i}=e,{top:n,bottom:s}=e.chartArea,{tooltip:r}=t,l=r.caretX;l&&(i.save(),i.beginPath(),i.moveTo(l,n),i.lineTo(l,s),i.stroke(),i.restore())}}]})}function latepoint_init_customer_donut_chart(){if("undefined"!=typeof Chart&&jQuery(".os-customer-donut-chart").length){var e=latepoint_helper.body_font_family;Chart.defaults.defaultFontFamily=e,Chart.defaults.defaultFontSize=16,Chart.defaults.defaultFontStyle="400",Chart.defaults.plugins.tooltip.titleFont={family:e,size:14,weight:400},Chart.defaults.plugins.tooltip.titleColor="rgba(255,255,255,0.6)",Chart.defaults.plugins.tooltip.backgroundColor="#000",Chart.defaults.plugins.tooltip.titleMarginBottom=1,Chart.defaults.plugins.tooltip.bodyFont={family:e,size:18,weight:500},Chart.defaults.plugins.tooltip.displayColors=!1,Chart.defaults.plugins.tooltip.padding=5,Chart.defaults.plugins.tooltip.yAlign="bottom",Chart.defaults.plugins.tooltip.xAlign="center",Chart.defaults.plugins.tooltip.cornerRadius=4,Chart.defaults.plugins.tooltip.intersect=!1,jQuery(".os-customer-donut-chart").each((function(e){var t=jQuery(this).data("chart-colors").toString().split(","),a=jQuery(this).data("chart-labels").toString().split(","),o=jQuery(this).data("chart-values").toString().split(",").map(Number),i=jQuery(this);new Chart(i,{type:"doughnut",data:{labels:a,datasets:[{data:o,backgroundColor:t,hoverBackgroundColor:t,borderWidth:0,hoverBorderColor:"transparent"}]},options:{layout:{padding:{top:10,bottom:10,left:10,right:10}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e){return e[0].label},label:function(e){return e.parsed}}}},animation:{animateRotate:!1},cutout:"90%",responsive:!1,maintainAspectRatio:!0}})}))}}function latepoint_init_donut_charts(){if("undefined"!=typeof Chart&&jQuery(".os-donut-chart").length){var e=latepoint_helper.body_font_family;Chart.defaults.defaultFontFamily=e,Chart.defaults.defaultFontSize=18,Chart.defaults.defaultFontStyle="400",Chart.defaults.plugins.tooltip.titleFont.family=e,Chart.defaults.plugins.tooltip.titleFont.size=14,Chart.defaults.plugins.tooltip.titleColor="rgba(255,255,255,0.6)",Chart.defaults.plugins.tooltip.backgroundColor="#000",Chart.defaults.plugins.tooltip.titleFont.style="400",Chart.defaults.plugins.tooltip.titleMarginBottom=1,Chart.defaults.plugins.tooltip.bodyFont.family=e,Chart.defaults.plugins.tooltip.bodyFont.size=24,Chart.defaults.plugins.tooltip.bodyFont.style="500",Chart.defaults.plugins.tooltip.displayColors=!1,Chart.defaults.plugins.tooltip.padding.x=10,Chart.defaults.plugins.tooltip.padding.y=8,Chart.defaults.plugins.tooltip.yAlign="bottom",Chart.defaults.plugins.tooltip.xAlign="center",Chart.defaults.plugins.tooltip.cornerRadius=8,Chart.defaults.plugins.tooltip.intersect=!1,jQuery(".os-donut-chart").each((function(e){var t=jQuery(this).data("chart-colors").toString().split(","),a=jQuery(this).data("chart-labels").toString().split(","),o=jQuery(this).data("chart-values").toString().split(",").map(Number),i=jQuery(this);new Chart(i,{type:"doughnut",data:{labels:a,datasets:[{data:o,backgroundColor:t,hoverBackgroundColor:t,borderWidth:0,hoverBorderColor:"transparent"}]},options:{layout:{padding:{top:40}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(e,t){return t.labels[e[0].index]},label:function(e,t){return t.datasets[0].data[e.index]}}}},animation:{animateScale:!0},cutoutPercentage:96,responsive:!1,maintainAspectRatio:!0}})}))}}function latepoint_init_circles_charts(){jQuery(".circle-chart").each((function(e){var t=jQuery(this).prop("id"),a=jQuery(this).data("max-value"),o=jQuery(this).data("chart-value"),i=jQuery(this).data("chart-color"),n=jQuery(this).data("chart-color-fade");Circles.create({id:t,radius:25,value:o,maxValue:a,width:2,text:function(e){return Math.round(e)},colors:[i,n],duration:200,wrpClass:"circles-wrp",textClass:"circles-text",valueStrokeClass:"circles-valueStroke",maxValueStrokeClass:"circles-maxValueStroke",styleWrapper:!0,styleText:!0})}))}function latepoint_check_horizontal_calendar_scroll(){jQuery(".daily-availability-calendar.horizontal-calendar").length&&jQuery(".daily-availability-calendar.horizontal-calendar").width()<700&&jQuery(".daily-availability-calendar.horizontal-calendar").scrollLeft(jQuery(".os-day.selected").index()*jQuery(".os-day.selected").width())}function latepoint_calendar_custom_period_created(){latepoint_reload_calendar_view(),latepoint_lightbox_close()}function latepoint_init_calendar_quick_actions(){latepoint_init_input_masks(jQuery(".quick-calendar-action-settings")),jQuery(".quick-calendar-action-day-off").on("click",(function(){return jQuery(".quick-calendar-actions-wrapper").addClass("showing-settings"),jQuery(".quick-calendar-actions").hide(),jQuery(".quick-calendar-action-settings").removeClass("setting-slot-off").addClass("setting-day-off"),jQuery('.quick-calendar-action-settings input[name="blocked_period_settings[full_day_off]"]').val("yes"),jQuery(".quick-calendar-action-toggle.selected").removeClass("selected"),jQuery('.quick-calendar-action-toggle[data-period-type="full"]').addClass("selected"),!1})),jQuery(".quick-calendar-action-slot-off").on("click",(function(){return jQuery(".quick-calendar-actions-wrapper").addClass("showing-settings"),jQuery(".quick-calendar-actions").hide(),jQuery(".quick-calendar-action-settings").removeClass("setting-day-off").addClass("setting-slot-off"),jQuery('.quick-calendar-action-settings input[name="blocked_period_settings[full_day_off]"]').val("no"),jQuery(".quick-calendar-action-toggle.selected").removeClass("selected"),jQuery('.quick-calendar-action-toggle[data-period-type="partial"]').addClass("selected"),!1})),jQuery(".quick-calendar-action-toggle").on("click",(function(){return"full"===jQuery(this).data("period-type")?jQuery(".quick-calendar-action-day-off").trigger("click"):jQuery(".quick-calendar-action-slot-off").trigger("click"),!1}))}function latepoint_init_calendars(){latepoint_check_horizontal_calendar_scroll(),jQuery(".os-calendar-settings-extra .latecheckbox").lateCheckbox(),jQuery(".os-calendar-view-toggle").on("click",".os-calendar-view-option",(function(){return jQuery(this).closest(".os-calendar-view-toggle").find(".os-calendar-view-option.os-selected").removeClass("os-selected"),jQuery(this).addClass("os-selected"),jQuery('input[name="'+jQuery(this).closest(".os-calendar-view-toggle").data("update-element-by-name")+'"]').val(jQuery(this).data("value")).trigger("change"),!1})),jQuery(".calendar-settings-toggler").on("click",(function(){return jQuery(".os-calendar-settings-form").toggleClass("show-extra-settings"),!1})),jQuery(".os-calendar-settings-form").on("change",'input[name="calendar_settings[view]"]',(function(){jQuery(this).closest(".calendar-wrapper").attr("data-view",jQuery(this).val())})),jQuery(".os-calendar-settings-form").on("change","select, input, .latecheckbox ",(function(){latepoint_reload_calendar_view()})),jQuery(".calendar-view-wrapper").on("click",".weekly-calendar-agent-selector",(function(){return jQuery(".weekly-calendar-agent-selector.selected").removeClass("selected"),jQuery(this).addClass("selected"),jQuery('.os-calendar-settings-form input[name="calendar_settings[selected_agent_id]"]').val(jQuery(this).data("agent-id")),jQuery(".agent-weekly-calendar.selected").removeClass("selected"),jQuery('.agent-weekly-calendar[data-agent-id="'+jQuery(this).data("agent-id")+'"]').addClass("selected"),!1})),jQuery(".calendar-view-wrapper").on("click",".daily-calendar-action-navigation-btn",(function(){return jQuery(this).addClass("os-loading"),jQuery('input[name="calendar_settings[target_date_string]"]').val(jQuery(this).data("target-date")).trigger("change"),!1})),jQuery(".calendar-view-wrapper").on("click",".daily-availability-calendar .os-day",(function(){return jQuery(".os-monthly-calendar-days-w .os-day.selected").removeClass("selected"),jQuery(this).addClass("selected"),jQuery('input[name="calendar_settings[target_date_string]"]').val(jQuery(this).data("date")).trigger("change"),!1})),jQuery(".os-calendar-today-btn").on("click",(function(){return jQuery(this).addClass("os-loading"),jQuery('input[name="calendar_settings[target_date_string]"]').val(jQuery(this).data("target-date")).trigger("change"),!1})),jQuery(".os-calendar-prev-btn").on("click",(function(){return jQuery(this).addClass("os-loading"),jQuery('input[name="calendar_settings[target_date_string]"]').val(jQuery('input[name="prev_target_date"]').val()).trigger("change"),!1})),jQuery(".os-calendar-next-btn").on("click",(function(){return jQuery(this).addClass("os-loading"),jQuery('input[name="calendar_settings[target_date_string]"]').val(jQuery('input[name="next_target_date"]').val()).trigger("change"),!1}))}function latepoint_reload_calendar_view(){let e=jQuery(".calendar-view-wrapper");if(!e.length)return;e.addClass("os-loading");let t=new FormData(jQuery("form.os-calendar-settings-form")[0]),a=new FormData;a.append("params",latepoint_formdata_to_url_encoded_string(t)),a.append("action",latepoint_helper.route_action),a.append("route_name",e.data("route")),a.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){"success"===t.status&&(e.html(t.message).removeClass("os-loading"),jQuery(".os-calendar-today-btn, .os-calendar-prev-btn, .os-calendar-next-btn").removeClass("os-loading"),jQuery(".os-current-month-label .current-month").text(t.top_date_label),jQuery(".os-current-month-label .current-year").text(t.top_date_year),latepoint_check_horizontal_calendar_scroll())}})}function latepoint_process_updated(){location.reload()}function latepoint_process_action_removed(e){e.closest(".os-form-block").remove()}function latepoint_replace_process_condition_element(e,t,a,o=null){e.closest(".sub-section-content").addClass("os-loading");let i=e.data("route"),n={action:latepoint_helper.route_action,route_name:i,params:t,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:t=>{t.status===latepoint_helper.response_status.success?(a.html(t.message),latepoint_init_process_conditions_form(),e.closest(".sub-section-content").removeClass("os-loading"),"function"==typeof o&&o()):alert("Error!")}})}function latepoint_init_process_forms(){latepoint_init_process_conditions_form(),jQuery(".os-processes-w").on("latepoint:initProcessActionForm latepoint:initProcessActionTypeSettings",".process-action-form",(async function(){if(jQuery(this).find(".latepoint-whatsapp-templates-loader").length){let e=jQuery(this).find(".latepoint-whatsapp-templates-loader"),t=jQuery(this).find(".process-action-settings"),a=jQuery(this).find(".latepoint-whatsapp-templates-holder");t.addClass("os-loading");let o={action:latepoint_helper.route_action,route_name:e.data("route"),params:{template_id:e.data("selected-template-id"),action_id:e.data("process-action-id"),process_id:e.data("process-id")},layout:"none",return_format:"json"};try{let i=await jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o});if(t.removeClass("os-loading"),"success"!==i.status)throw new Error(i.message);e.remove(),a.html(i.message)}catch(e){t.removeClass("os-loading"),console.log(e),alert(e)}}})),jQuery(".os-processes-w").on("click",".os-run-process",(function(){let e=jQuery(this);e.addClass("os-loading");let t=e.closest(".os-process-form");jQuery(".os-process-form.prepared-to-run").removeClass("prepared-to-run"),t.addClass("prepared-to-run");let a=new FormData(t[0]);a.set("process_event_type",t.closest(".os-process-form").find(".process-event-type-selector").val());let o=new FormData;return o.append("params",latepoint_formdata_to_url_encoded_string(a)),o.append("action",latepoint_helper.route_action),o.append("route_name",e.data("route")),o.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:o,success:function(t){latepoint_show_data_in_side_panel(t.message,"width-600"),latepoint_init_process_test_form(),e.removeClass("os-loading")}}),!1})),jQuery(".os-processes-w").find(".process-action-form").each((function(e){latepoint_init_process_action_form(jQuery(this))})),jQuery(".os-processes-w").on("click",".pe-remove-condition",(e=>(jQuery(e.currentTarget).closest(".pe-conditions").find(".pe-condition").length>1?jQuery(e.currentTarget).closest(".pe-condition").remove():alert("You need to have at least one condition if your custom field is set to be conditional."),!1))),jQuery(".os-processes-w").on("change","select.process-condition-operator-selector",(e=>{let t=jQuery(e.currentTarget);"changed"==t.val()||"not_changed"==t.val()?t.closest(".pe-condition").find(".process-condition-values-w").hide():t.closest(".pe-condition").find(".process-condition-values-w").show()})),jQuery(".os-processes-w").on("change","select.process-event-type-selector",(e=>{let t=jQuery(e.currentTarget);latepoint_replace_process_condition_element(t,{event_type:t.val()},t.closest(".os-form-block").find(".process-event-condition-wrapper"))})),jQuery(".os-processes-w").on("change","select.process-condition-object-selector",(e=>{let t=jQuery(e.currentTarget),a=t.closest(".pe-condition").find(".process-condition-properties-w select");latepoint_replace_process_condition_element(t,{object_code:t.val()},a,(()=>{a.trigger("change")}))})),jQuery(".os-processes-w").on("change","select.process-condition-property-selector",(e=>{let t=jQuery(e.currentTarget),a=t.closest(".pe-condition").find(".process-condition-operators-w select");latepoint_replace_process_condition_element(t,{property:t.val()},a,(()=>{a.trigger("change")}))})),jQuery(".os-processes-w").on("change","select.process-condition-operator-selector",(e=>{let t=jQuery(e.currentTarget);latepoint_replace_process_condition_element(t,{property:t.closest(".pe-condition").find("select.process-condition-property-selector").val(),trigger_condition_id:t.closest(".pe-condition").data("condition-id"),operator:t.val()},t.closest(".pe-condition").find(".process-condition-values-w"))}))}function latepoint_init_process_conditions_form(){jQuery(".os-late-select").lateSelect()}function latepoint_add_process_condition(e,t){e.closest(".pe-condition").after(t.message),latepoint_init_process_conditions_form()}function latepoint_init_added_process_action_form(e){let t=e.prev(".process-action-form");t.addClass("is-editing").trigger("latepoint:initProcessActionForm"),latepoint_init_process_action_form(t)}function latepoint_init_process_test_form(){jQuery(".latepoint-run-process-btn").on("click",(function(){let e=jQuery(this);if(e.hasClass("os-loading"))return!1;e.addClass("os-loading");jQuery(".latepoint-side-panel-w .action-settings-wrapper");let t=new FormData(jQuery(".os-process-form.prepared-to-run")[0]);jQuery(".process-test-data-source-selector").each((function(){t.set(jQuery(this).prop("name"),jQuery(this).val())})),
jQuery(".process-test-data-source-selector").each((function(){t.set(jQuery(this).prop("name"),jQuery(this).val())}));let a=[];jQuery('.action-to-run input[type="hidden"]').each((function(){"on"==jQuery(this).val()&&a.push(jQuery(this).closest(".action-to-run").data("id"))})),t.set("action_ids",a.join(","));let o=new FormData;o.append("params",latepoint_formdata_to_url_encoded_string(t)),o.append("action",latepoint_helper.route_action),o.append("route_name",e.data("route")),o.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:o,success:function(t){e.removeClass("os-loading"),"success"==t.status?latepoint_add_notification(t.message):latepoint_add_notification(t.message,"error")}})})),jQuery(".process-action-test-data-source-selector").on("change",(function(){}))}function latepoint_init_process_action_test_form(){latepoint_init_json_view(jQuery(".action-preview-wrapper.type-trigger_webhook pre")),jQuery(".latepoint-run-action-btn").on("click",(function(){let e=jQuery(this);if(e.hasClass("os-loading"))return!1;e.addClass("os-loading");let t=jQuery(".latepoint-side-panel-w .action-settings-wrapper"),a=new FormData;a.append("params",t.find("select, textarea, input").serialize()),a.append("action",latepoint_helper.route_action),a.append("route_name",e.data("route")),a.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){e.removeClass("os-loading"),"success"==t.status?latepoint_add_notification(t.message):latepoint_add_notification(t.message,"error")}})})),jQuery(".process-action-test-data-source-selector").on("change",(function(){let e=jQuery(this);jQuery(".action-preview-wrapper").addClass("os-loading");let t=e.closest(".action-settings-wrapper"),a=new FormData;a.append("params",t.find("select, textarea, input").serialize()),a.append("action",latepoint_helper.route_action),a.append("route_name",e.data("route")),a.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:a,success:function(e){jQuery(".action-preview-wrapper").html(e.message).removeClass("os-loading"),latepoint_init_json_view(jQuery(".action-preview-wrapper.type-trigger_webhook pre"))}})}))}function latepoint_init_process_action_form(e){e.on("click",".os-run-process-action",(function(){let e=jQuery(this);e.addClass("os-loading");let t=e.closest(".process-action-form");void 0!==window.tinyMCE&&window.tinyMCE.triggerSave();let a=new FormData,o=latepoint_create_form_data_from_non_form_element(t);return o.set("process_event_type",t.closest(".os-process-form").find(".process-event-type-selector").val()),a.append("params",latepoint_formdata_to_url_encoded_string(o)),a.append("action",latepoint_helper.route_action),a.append("route_name",e.data("route")),a.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){latepoint_show_data_in_side_panel(t.message,"width-800"),latepoint_init_process_action_test_form(),e.removeClass("os-loading")}}),!1})),e.on("click",".process-action-heading",(function(){let e=jQuery(this).closest(".process-action-form");return e.hasClass("is-editing")||e.trigger("latepoint:initProcessActionForm"),e.toggleClass("is-editing"),!1})),e.find("textarea.os-wp-editor-textarea").each((function(e){latepoint_init_tiny_mce(jQuery(this).attr("id"))})),e.on("click",".os-remove-process-action",(function(){return confirm(jQuery(this).data("os-prompt"))&&jQuery(this).closest(".process-action-form").remove(),!1})),e.on("change",".process-action-type-whatsapp-template-selector",(async function(){let e=jQuery(this),t=e.closest(".process-action-settings").find(".latepoint-whatsapp-template-preview-holder");t.addClass("os-loading");let a={action:latepoint_helper.route_action,route_name:e.data("route"),params:{template_id:e.val(),action_id:e.data("action-id")},layout:"none",return_format:"json"};try{let e=await jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a});if(t.removeClass("os-loading"),"success"!==e.status)throw new Error(e.message);t.html(e.message)}catch(e){t.removeClass("os-loading"),console.log(e),alert(e)}return!1})),e.on("change",".process-action-type",(function(){let e=jQuery(this);jQuery(this).closest(".process-action-form").find(".process-action-name").text(e.find("option:selected").text());let t=e.val(),a=e.data("action-id"),o=e.data("route"),i=e.closest(".process-action-content").find(".process-action-settings");i.addClass("os-loading");let n={action:latepoint_helper.route_action,route_name:o,params:{action_type:t,action_id:a},layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:function(t){i.html(t.message).removeClass("os-loading");let a=e.closest(".process-action-form");latepoint_init_input_masks(a),a.trigger("latepoint:initProcessActionTypeSettings")}}),!1}))}function latepoint_preview_init_step_category_items(e){jQuery(".booking-form-preview .os-item-category-info").on("click",(function(){jQuery(this).closest(".booking-form-preview");jQuery(this).closest(".latepoint-step-content").addClass("selecting-item-category");var e=jQuery(this).closest(".os-item-category-w"),t=jQuery(this).closest(".os-item-categories-main-parent");return e.hasClass("selected")?(e.removeClass("selected"),e.parent().closest(".os-item-category-w").length?e.parent().closest(".os-item-category-w").addClass("selected"):t.removeClass("show-selected-only")):(t.find(".os-item-category-w.selected").removeClass("selected"),t.addClass("show-selected-only"),e.addClass("selected")),!1}))}function latepoint_booking_form_discard_changes(){let e=new FormData(jQuery(".booking-form-preview-settings")[0]);var t={action:latepoint_helper.route_action,route_name:jQuery(".booking-form-preview-settings").data("route-name"),params:latepoint_formdata_to_url_encoded_string(e),layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(e){"success"===e.status?(jQuery(".booking-form-preview-inner").html(e.booking_form_html),latepoint_init_booking_form_preview()):latepoint_add_notification(e.message,"error")}})}function latepoint_booking_form_save_changes(){let e=new FormData(jQuery(".booking-form-preview-settings")[0]);jQuery(".editable-setting").each((function(){e.set("steps_settings"+jQuery(this).data("setting-key"),jQuery(this).html())})),e.set("steps_settings"+jQuery(".bf-side-media-picker-trigger").find(".os-image-id-holder").prop("name"),jQuery(".bf-side-media-picker-trigger").find(".os-image-id-holder").val());var t={action:latepoint_helper.route_action,route_name:jQuery(".booking-form-preview-settings").data("route-name"),params:latepoint_formdata_to_url_encoded_string(e),layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(e){jQuery(".booking-form-preview-settings").removeClass("os-loading"),"success"===e.status?(jQuery(".bf-preview-step-settings").html(e.step_settings_html),jQuery(".booking-form-preview-inner").html(e.booking_form_html),jQuery("#latepoint-main-admin-inline-css").html(e.css_variables),latepoint_init_booking_form_preview()):latepoint_add_notification(e.message,"error")}})}function latepoint_init_booking_form_preview(){latepoint_preview_init_step_category_items(),latepoint_booking_form_preview_init_datepicker(),jQuery(".booking-form-preview-wrapper").on("click",".os-step-tab",(function(){let e=jQuery(this).closest(".latepoint-booking-form-element");jQuery(this).closest(".os-step-tabs").find(".os-step-tab").removeClass("active"),jQuery(this).addClass("active");var t=jQuery(this).data("target");jQuery(this).closest(".os-step-tabs-w").find(".os-step-tab-content").hide(),jQuery(t).show(),jQuery(this).data("auth-action")&&e.find('input[name="auth[action]"]').val(jQuery(this).data("auth-action"))})),jQuery(".bf-save-btn").on("click",(function(){return jQuery(this).addClass("os-loading"),latepoint_booking_form_save_changes(),!1})),jQuery(".bf-cancel-save-btn").on("click",(function(){return jQuery(this).addClass("os-loading"),latepoint_booking_form_discard_changes(),!1})),jQuery(".booking-form-preview .bf-next-btn").on("click",(function(){jQuery(this).addClass("os-loading"),jQuery("#selected_step_code > option:selected").prop("selected",!1).next().prop("selected",!0).trigger("change")})),jQuery(".booking-form-preview .bf-prev-btn").on("click",(function(){jQuery(this).addClass("os-loading"),jQuery("#selected_step_code > option:selected").prop("selected",!1).prev().prop("selected",!0).trigger("change")})),jQuery(".booking-form-preview .os-image-selector-trigger").on("click",(function(){jQuery(".booking-form-preview").addClass("has-changes")})),jQuery(".booking-form-preview .editable-setting").on("focus",(function(){jQuery(".booking-form-preview").addClass("has-changes")}));new MediumEditor(".booking-form-preview .os-editable",{toolbar:{buttons:[{name:"bold",classList:["latepoint-icon","latepoint-icon-format_bold"]},{name:"anchor",classList:["latepoint-icon","latepoint-icon-format_link"]},{name:"h3",classList:["latepoint-icon","latepoint-icon-format_h3"]},{name:"h4",classList:["latepoint-icon","latepoint-icon-format_h4"]},{name:"h5",classList:["latepoint-icon","latepoint-icon-format_h5"]}]}}),new MediumEditor(".booking-form-preview .os-editable-basic",{toolbar:{buttons:[{name:"bold",classList:["latepoint-icon","latepoint-icon-format_bold"]},{name:"italic",classList:["latepoint-icon","latepoint-icon-format_italic"]},{name:"underline",classList:["latepoint-icon","latepoint-icon-format_underlined"]},{name:"anchor",classList:["latepoint-icon","latepoint-icon-format_link"]}]}})}function latepoint_reload_booking_form_preview(){latepoint_booking_form_save_changes()}function latepoint_init_steps_settings(){jQuery(".booking-form-preview-settings").on("change",' select, input[type="hidden"]',(function(){jQuery(".booking-form-preview-settings").addClass("os-loading"),latepoint_reload_booking_form_preview()})),jQuery(".trigger-custom-color-save").on("click",(function(){return jQuery(".booking-form-preview-settings").addClass("os-loading"),latepoint_booking_form_save_changes(),!1})),jQuery(".bf-color-scheme-color-trigger").on("click",(function(){jQuery(".bf-color-scheme-color-trigger.is-selected").removeClass("is-selected"),jQuery(this).addClass("is-selected");let e=jQuery(this).data("color-code");return jQuery(".os-color-scheme-selector-wrapper select").val(e).trigger("change"),"custom"==e?jQuery(".os-custom-color-selector-wrapper").removeClass("is-hidden"):jQuery(".os-custom-color-selector-wrapper").addClass("is-hidden"),!1})),jQuery(".os-section-collapsible-trigger").on("click",(function(){return jQuery(this).closest(".os-section-collapsible-wrapper").toggleClass("is-open"),!1}))}function latepoint_booking_form_preview_init_timeslots(e=!1){e&&e.on("click",".dp-timepicker-trigger",(function(){if(jQuery(this).hasClass("is-booked")||jQuery(this).hasClass("is-off"));else if(jQuery(this).hasClass("selected"))jQuery(this).removeClass("selected"),jQuery(this).find(".dp-success-label").remove();else{e.find(".dp-timepicker-trigger.selected").removeClass("selected").find(".dp-success-label").remove();jQuery(this).find(".dp-label-time").html();jQuery(this).addClass("selected").find(".dp-label").prepend('<span class="dp-success-label">'+latepoint_helper.datepicker_timeslot_selected_label+"</span>");parseInt(jQuery(this).data("minutes"));var t=new Date(e.find(".os-day.selected").data("date"));e.find(".latepoint_start_date").val(t.toISOString().split("T")[0]),latepoint_trigger_next_btn(e)}return!1}))}function latepoint_booking_form_preview_day_timeslots(e){let t=jQuery(".booking-form-preview");e.addClass("selected");var a=e.data("service-duration"),o=e.data("interval"),i=(e.data("work-start-time"),e.data("work-end-time"),e.data("total-work-minutes")),n=[],s=[];if(e.attr("data-bookable-minutes"))if(e.data("bookable-minutes").toString().indexOf(":")>-1){let t=e.data("bookable-minutes").toString().split(",");for(let e=0;e<t.length;e++)n.push(parseInt(t[e].split(":")[0])),s.push(parseInt(t[e].split(":")[1]))}else n=e.data("bookable-minutes").toString().split(",").map(Number);var r=e.data("work-minutes").toString().split(",").map(Number),l=t.find(".timeslots");if(l.html(""),i>0&&n.length&&r.length){var c=!1;r.forEach((function(e){var r=latepoint_am_or_pm(e),d="dp-timepicker-trigger",u=0;if("timeline"==t.find(".os-dates-w").data("time-pick-style")?d+=" dp-timeslot":d+=" dp-timebox",!1!==c&&e-c>a){var p=latepoint_minutes_to_hours_and_minutes(c+a)+" "+latepoint_am_or_pm(c+a)+" - "+latepoint_minutes_to_hours_and_minutes(e)+" "+latepoint_am_or_pm(e),_=(e-c-a)/i*100;l.append('<div class="'+d+' is-off" style="max-width:'+_+"%; width:"+_+'%"><span class="dp-label">'+p+"</span></div>")}n.includes(e)?s.length&&(u=s[n.indexOf(e)]):d+=" is-booked";var m="",f="",y="",g="";(e%60==0||o>=60)&&(d+=" with-tick",m='<span class="dp-tick"><strong>'+latepoint_minutes_to_hours_preferably(e)+"</strong> "+r+"</span>");var h=latepoint_minutes_to_hours_and_minutes(e)+" "+r;if(latepoint_show_booking_end_time()){var j=e+a;j>1440&&(j-=1440);var v=latepoint_am_or_pm(j);h+=' - <span class="dp-label-end-time">'+latepoint_minutes_to_hours_and_minutes(j)+" "+v+"</span>"}u&&(y='<span class="dp-capacity">'+(f=u+" "+(u>1?latepoint_helper.many_spaces_message:latepoint_helper.single_space_message))+"</span>",g='<span class="dp-label-capacity">'+f+"</span>");h=h.trim(),l.removeClass("slots-not-available").append('<div class="'+d+'" data-minutes="'+e+'"><span class="dp-label">'+g+'<span class="dp-label-time">'+h+"</span></span>"+m+y+"</div>"),c=e}))}else l.addClass("slots-not-available").append('<div class="not-working-message">'+latepoint_helper.msg_not_available+"</div>");jQuery(".times-header-label span").text(e.data("nice-date")),t.find(".time-selector-w").slideDown(200)}function latepoint_booking_form_preview_init_monthly_calendar_navigation(e){e&&(e.on("click",".os-month-next-btn",(function(){var e=jQuery(this).closest(".latepoint-booking-form-element");jQuery(this).data("route");return e.find(".os-monthly-calendar-days-w.active + .os-monthly-calendar-days-w").length?(e.find(".os-monthly-calendar-days-w.active").removeClass("active").next(".os-monthly-calendar-days-w").addClass("active"),latepoint_booking_form_preview_calendar_set_month_label(e)):alert("Disabled in preview"),latepoint_calendar_show_or_hide_prev_next_buttons(e),!1})),e.on("click",".os-month-prev-btn",(function(){var e=jQuery(this).closest(".latepoint-booking-form-element");return e.find(".os-monthly-calendar-days-w.active").prev(".os-monthly-calendar-days-w").length&&(e.find(".os-monthly-calendar-days-w.active").removeClass("active").prev(".os-monthly-calendar-days-w").addClass("active"),latepoint_booking_form_preview_calendar_set_month_label(e)),!1})))}function latepoint_booking_form_preview_calendar_set_month_label(){jQuery(".os-current-month-label .current-month").text(jQuery(".os-monthly-calendar-days-w.active").data("calendar-month-label")),jQuery(".os-current-month-label .current-year").text(jQuery(".os-monthly-calendar-days-w.active").data("calendar-year"))}function latepoint_booking_form_preview_init_datepicker(){let e=jQuery(".latepoint-booking-form-element");latepoint_booking_form_preview_init_timeslots(e),latepoint_booking_form_preview_init_monthly_calendar_navigation(e),e.on("click",".os-months .os-day",(function(){if(jQuery(this).hasClass("os-day-passed"))return!1;if(jQuery(this).hasClass("os-not-in-allowed-period"))return!1;if(jQuery(this).hasClass("os-month-prev"))return!1;if(jQuery(this).hasClass("os-month-next"))return!1;if(jQuery(this).closest(".os-monthly-calendar-days-w").hasClass("hide-if-single-slot"))if(jQuery(this).hasClass("os-not-available"));else if(e.find(".os-day.selected").removeClass("selected"),jQuery(this).addClass("selected"),e.find(".latepoint_start_date").val(jQuery(this).data("date")),jQuery(this).hasClass("os-one-slot-only")){var t=jQuery(this).data("bookable-minutes").toString().split(":")[0];latepoint_format_minutes_to_time(Number(t),Number(jQuery(this).data("service-duration")));e.find(".time-selector-w").slideUp(200)}else latepoint_booking_form_preview_day_timeslots(jQuery(this));else e.find(".latepoint_start_date").val(jQuery(this).data("date")),e.find(".os-day.selected").removeClass("selected"),jQuery(this).addClass("selected"),latepoint_booking_form_preview_day_timeslots(jQuery(this));return!1}))}function latepoint_submit_quick_order_form(){let e=jQuery("form.order-quick-edit-form"),t=latepoint_validate_form(e);if(t.length){return latepoint_add_notification(t.map((e=>e.message)).join(", "),"error"),!1}e.find('button[type="submit"]').addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:latepoint_create_form_data(e),success:function(t){if(t.fields_to_update)for(const[a,o]of Object.entries(t.fields_to_update))e.find('input[name="'+a+'"]').val(o);e.find('button[type="submit"]').removeClass("os-loading"),t.form_values_to_update&&jQuery.each(t.form_values_to_update,(function(t,a){e.find('[name="'+t+'"]').val(a)})),"success"===t.status?(latepoint_add_notification(t.message),latepoint_reload_after_order_save()):latepoint_add_notification(t.message,"error")}})}function latepoint_apply_agent_selector_change(){if(jQuery(".quick-availability-per-day-w").length){let e=jQuery(".quick-availability-per-day-w").data("trigger-form-booking-id");latepoint_load_quick_availability(jQuery('.order-item-booking-data-form-wrapper[data-booking-id="'+e+'"]').find(".trigger-quick-availability"))}}function latepoint_apply_service_selector_change(e){let t="order_items["+e.data("order-item-id")+"][bookings]["+e.data("booking-id")+"]";var a=e.find(".os-services-select-field-w .service-option-selected"),o=a.data("id"),i=a.data("buffer-before"),n=a.data("buffer-after"),s=a.data("duration"),r=a.data("duration-name"),l=(a.data("capacity-min"),a.data("capacity-max")),c=a.data("extra-durations");e.find('input[name="'+t+'[buffer_before]"]').val(i).trigger("change").closest(".os-form-group").addClass("has-value"),e.find('input[name="'+t+'[buffer_after]"]').val(n).trigger("change").closest(".os-form-group").addClass("has-value"),e.find('input[name="'+t+'[service_id]"]').val(o).trigger("change").closest(".os-form-group").addClass("has-value");var d='<option value="'+s+'">'+(r||s+" "+latepoint_helper.string_minutes)+"</option>";c.length?(jQuery.each(c,(function(e,t){var a=t.name?t.name:t.duration+" "+latepoint_helper.string_minutes;d+='<option value="'+t.duration+'">'+a+"</option>"})),e.find(".os-service-durations").show()):e.find(".os-service-durations").hide(),e.find(".booking-total-attendees-selector-w .capacity-info strong").text(l);for(var u="",p=1;p<=l;p++)u+='<option value="'+p+'">'+p+"</option>";var _=Math.min(jQuery(".booking-total-attendees-selector-w select").val(),l);e.find(".booking-total-attendees-selector-w select").html(u).val(_),l>1?e.find(".booking-total-attendees-selector-w").show():e.find(".booking-total-attendees-selector-w").hide(),e.find(".os-service-durations select").html(d),latepoint_set_booking_end_time(e),jQuery(".quick-availability-per-day-w").length&&latepoint_load_quick_availability(e.find(".trigger-quick-availability")),latepoint_init_input_masks(e)}function latepoint_reload_balance_and_payments(){let e=jQuery(".balance-payment-info");e.closest(".balance-payment-wrapper").addClass("os-loading");let t=e.data("route"),a=e.closest("form.order-quick-edit-form"),o=new FormData(a[0]),i={action:latepoint_helper.route_action,route_name:t,params:latepoint_formdata_to_url_encoded_string(o),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:i,success:function(t){e.closest(".balance-payment-wrapper").removeClass("os-loading"),"success"===t.status?(jQuery(".balance-payment-wrapper").html(t.message),latepoint_init_input_masks(jQuery(".balance-payment-wrapper")),latepoint_init_daterangepicker(jQuery(".balance-payment-wrapper .os-date-range-picker")),latepoint_init_payment_request_form(jQuery(".quick-order-form-w"))):alert(t.message)}})}function latepoint_cancel_adding_new_order_item_to_quick_edit_form(){jQuery(".order-items-list").removeClass("is-blurred"),jQuery(".new-order-item-list-bundles-wrapper").removeClass("is-open"),jQuery(".new-order-item-variant-selector-wrapper").removeClass("is-open"),jQuery(".order-form-add-item-btn").removeClass("is-cancelling").find("span").text(jQuery(".order-form-add-item-btn").data("add-label"))}function latepoint_build_new_booking_order_item(){jQuery(".order-form-add-item-btn").addClass("os-loading"),latepoint_cancel_adding_new_order_item_to_quick_edit_form();var e={action:"latepoint_route_call",route_name:jQuery(".order-form-add-item-btn").data("booking-form-route-name"),params:{},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:e,success:function(e){if("success"===e.status){let t=jQuery(e.message);jQuery(".order-items-list").prepend(t),jQuery(".order-form-add-item-btn").removeClass("os-loading"),latepoint_init_booking_data_form(jQuery('.order-item-booking-data-form-wrapper[data-order-item-id="'+t.data("order-item-id")+'"]')),latepoint_quick_order_items_changed()}else alert(e.message,"error")}})}function latepoint_build_booking_data_form_for_bundle(e){e.addClass("os-loading"),latepoint_cancel_adding_new_order_item_to_quick_edit_form();let t=e.hasClass("is-booked");var a={action:"latepoint_route_call",route_name:jQuery(".order-form-add-item-btn").data("booking-form-route-name"),params:{order_item_id:e.data("order-item-id"),order_item_variant:e.data("order-item-variant"),booking_id:e.data("booking-id"),booking_item_data:t?e.find(".booking_item_data").val():e.find(".unscheduled_booking_item_data").val()},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){if("success"===t.status){let a=jQuery(t.message);e.removeClass("os-loading"),e?e.find(".scheduled-bundle-booking").html(a).closest(".order-item-variant-bundle-booking ").addClass("is-booked"):jQuery(".order-items-list").prepend(a),latepoint_init_booking_data_form(jQuery('.order-item-booking-data-form-wrapper[data-order-item-id="'+a.data("order-item-id")+'"][data-booking-id="'+a.data("booking-id")+'"]')),e||latepoint_quick_order_items_changed()}else alert(t.message,"error")}})}function latepoint_bundle_added_to_quick_order(){latepoint_quick_order_items_changed(),latepoint_cancel_adding_new_order_item_to_quick_edit_form()}function latepoint_quick_order_items_changed(){latepoint_reload_price_breakdown()}function latepoint_fold_booking_data_form_in_order_quick_edit(e){if(!e.length)return!1;latepoint_close_quick_availability_form(),latepoint_show_all_order_items();let t=e.data("order-item-id"),a=e.data("booking-id"),o=e.data("order-item-variant");e.addClass("is-loading");let i=new FormData(jQuery(".order-quick-edit-form")[0]);i.set("order_item_id",t),i.set("booking_id",a);var n={action:"latepoint_route_call",route_name:jQuery(".order-form-add-item-btn").data("fold-booking-data-route-name"),params:latepoint_formdata_to_url_encoded_string(i),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:function(t){"success"===t.status?(e.removeClass("is-loading").removeClass("is-unfolded").addClass("is-folded"),o==latepoint_helper.order_item_variant_bundle?(e.closest(".order-item-variant-bundle-booking").addClass("is-booked"),e.find(".bundle-booking-item-pill").replaceWith(t.message)):e.find(".order-item-pill").replaceWith(t.message)):alert(t.message,"error")}})}function latepoint_init_booking_data_form(e){latepoint_init_input_masks(e),e.find(".fold-order-item-booking-data-form-btn").on("click",(function(){return latepoint_fold_booking_data_form_in_order_quick_edit(e),!1})),e.find(".quick-booking-form-view-log-btn").on("click",(function(){var e=jQuery(this);e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route"),params:{booking_id:e.data("booking-id")},return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_display_in_side_sub_panel(t.message),jQuery("body").addClass("has-side-sub-panel")):alert(t.message,"error")}}),!1})),e.find(".os-late-select").lateSelect(),e.find(".trigger-quick-availability").on("click",(function(){return latepoint_load_quick_availability(jQuery(this)),!1}));let t="order_items["+e.data("order-item-id")+"][bookings]["+e.data("booking-id")+"]";e.find('input[name="'+t+'[start_time][formatted_value]"]').on("change",(function(){latepoint_set_booking_end_time(e)})),e.find('input[name="'+t+'[end_time][formatted_value]"]').on("change",(function(){latepoint_is_next_day(e)})),e.on("change",".agent-selector",(function(){latepoint_apply_agent_selector_change(e)})),e.on("change",".location-selector",(function(){latepoint_apply_agent_selector_change(e)})),e.on("change",'select[name="booking[location_id]"]',(function(){latepoint_apply_agent_selector_change(e)})),e.on("change",'select[name="booking[total_attendees]"]',(function(){latepoint_apply_agent_selector_change(e)})),e.on("change",".os-affects-duration",(function(){latepoint_set_booking_end_time(e),jQuery(".quick-availability-per-day-w").length&&latepoint_load_quick_availability(e.find(".trigger-quick-availability"))})),e.on("change",".os-affects-price",(function(){latepoint_reload_price_breakdown()})),e.on("change",".os-affects-balance",(function(){latepoint_reload_balance_and_payments()})),e.on("keyup",".os-affects-balance",(function(e){13==e.keyCode&&latepoint_reload_balance_and_payments()})),e.on("click",".services-options-list .service-option",(function(){var t=jQuery(this).html();return jQuery(this).closest(".os-services-select-field-w").find(".service-option-selected").html(t).data("id",jQuery(this).data("id")).data("duration",jQuery(this).data("duration")).data("duration-name",jQuery(this).data("duration-name")).data("buffer-before",jQuery(this).data("buffer-before")).data("buffer-after",jQuery(this).data("buffer-after")).data("capacity-min",jQuery(this).data("capacity-min")).data("capacity-max",jQuery(this).data("capacity-max")).data("extra-durations",jQuery(this).data("extra-durations")),jQuery(this).closest(".os-services-select-field-w").find(".service-option.selected").removeClass("selected"),jQuery(this).addClass("selected").closest(".os-services-select-field-w").removeClass("active"),latepoint_apply_service_selector_change(e),!1})),e.trigger("latepoint:initBookingDataForm")}function latepoint_init_payment_request_form(e){e.find('select[name="payment_request[portion]"]').on("change",(function(){"custom"==jQuery(this).val()?e.find(".custom-charge-amount-wrapper").show():e.find(".custom-charge-amount-wrapper").hide()}))}function latepoint_show_all_order_items(){let e=jQuery(".quick-order-form-w");e.find(".order-items-info-w").removeClass("show-preselected-only"),e.find(".holds-preselected-booking").removeClass("holds-preselected-booking")}function latepoint_init_quick_order_form(){let e=jQuery(".quick-order-form-w");e.trigger("latepoint:initOrderEditForm"),e.on("change",".os-affects-balance",(function(){latepoint_reload_balance_and_payments()})),e.on("keyup",".os-affects-balance",(function(e){13==e.keyCode&&latepoint_reload_balance_and_payments()})),latepoint_init_customer_inline_edit_form(e.find(".customer-info-w")),e.find(".order-item-booking-data-form-wrapper").each((function(){latepoint_init_booking_data_form(jQuery(this))})),latepoint_lightbox_close(),latepoint_remove_floating_popup(),latepoint_init_input_masks(e),latepoint_init_daterangepicker(e.find(".os-date-range-picker")),latepoint_init_payment_request_form(e),e.on("click",".transaction-refund-settings-button",(function(){jQuery(this).closest(".quick-add-transaction-box-w").addClass("show-refund-settings")})),e.on("click",".transaction-refund-submit-button",(function(){let e=jQuery(this);if(confirm(jQuery(this).data("os-prompt"))){e.addClass("os-loading");let t={action:"latepoint_route_call",route_name:e.data("route"),params:e.closest(".refund-settings-fields").find("input, textarea, select").serialize(),return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(e.closest(".quick-add-transaction-box-w").replaceWith(t.message),latepoint_reload_balance_and_payments()):alert(t.message,"error")}}),!1}})),e.on("click",".refund-settings-close",(function(){jQuery(this).closest(".quick-add-transaction-box-w").removeClass("show-refund-settings")})),e.on("change",".refund-portion-selector",(function(){"full"==jQuery(this).val()?jQuery(this).closest(".refund-settings-fields").find(".custom-charge-amount-wrapper").hide():jQuery(this).closest(".refund-settings-fields").find(".custom-charge-amount-wrapper").show()})),e.find(".quick-order-form-view-log-btn").on("click",(function(){var e=jQuery(this);e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route"),params:{order_id:e.data("order-id")},return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_display_in_side_sub_panel(t.message),jQuery("body").addClass("has-side-sub-panel")):alert(t.message,"error")}}),!1})),e.find(".new-order-item-variant-bundle").on("click",(function(){return e.find(".new-order-item-list-bundles-wrapper").toggleClass("is-open"),e.find(".new-order-item-variant-selector-wrapper").toggleClass("is-open"),!1})),e.find(".hidden-order-items-notice-link, .hidden-bundle-items-notice-link").on("click",(function(e){return latepoint_show_all_order_items(),!1})),e.find(".order-quick-edit-form").on("submit",(function(e){if(jQuery(this).find('button[type="submit"]').hasClass("os-loading"))return!1;e.preventDefault(),latepoint_submit_quick_order_form()})),e.on("keydown",":input:not(textarea):not(:submit)",(function(e){"Enter"==e.key&&e.preventDefault()})),e.find(".order-items-list").on("click",".remove-order-item-btn",(function(){return latepoint_close_quick_availability_form(),confirm(jQuery(this).data("os-prompt"))&&(jQuery(this).closest(".order-item-variant-bundle-booking-wrapper").length?jQuery(this).closest(".order-item-variant-bundle-booking").removeClass("is-booked").find(".scheduled-bundle-booking").html(""):(jQuery(this).closest(".order-item").remove(),jQuery(this).closest(".order-item-booking-data-form-wrapper").remove()),latepoint_quick_order_items_changed()),!1})),e.find(".new-order-item-variant-booking").on("click",(function(){latepoint_fold_all_open_booking_data_forms(),latepoint_build_new_booking_order_item()})),e.on("click",".order-item-pill.order-item-pill-variant-booking",(function(){return jQuery(this).closest(".order-item-booking-data-form-wrapper").removeClass("is-folded").addClass("is-unfolded"),!1})),e.on("click",".bundle-booking-item-pill",(function(){return jQuery(this).closest(".order-item-booking-data-form-wrapper").removeClass("is-folded").addClass("is-unfolded"),!1})),e.on("click",".unscheduled-bundle-booking",(function(){latepoint_build_booking_data_form_for_bundle(jQuery(this).closest(".order-item-variant-bundle-booking"))})),e.find(".order-form-add-item-btn").on("click",(function(){return jQuery(".order-item-booking-data-form-wrapper").each((function(){
latepoint_fold_booking_data_form_in_order_quick_edit(jQuery(this))})),jQuery(this).hasClass("is-cancelling")?latepoint_cancel_adding_new_order_item_to_quick_edit_form():jQuery(".new-order-item-variant-selector-wrapper").length?(jQuery(".order-items-list").addClass("is-blurred"),jQuery(".new-order-item-variant-selector-wrapper").addClass("is-open"),jQuery(this).addClass("is-cancelling").find("span").text(jQuery(this).data("cancel-label"))):(latepoint_cancel_adding_new_order_item_to_quick_edit_form(),latepoint_build_new_booking_order_item()),!1})),e.on("click",".order-item-variant-bundle .bundle-icon",(function(){return jQuery(this).closest(".order-item-variant-bundle").toggleClass("is-open"),!1})),e.find(".reload-price-breakdown").on("click",(function(){return latepoint_reload_price_breakdown(),!1})),e.on("click",".trigger-remove-transaction-btn",(function(){return jQuery(this).closest(".quick-add-transaction-box-w").remove(),!1})),e.trigger("latepoint:initQuickOrderForm")}function latepoint_fold_all_open_booking_data_forms(){jQuery(".order-item-booking-data-form-wrapper").each((function(){latepoint_fold_booking_data_form_in_order_quick_edit(jQuery(this))}))}function latepoint_init_customer_inline_edit_form(e){latepoint_init_input_masks(e),e.find(".customers-selector-search-input").on("keyup",(function(){var e=jQuery(this),t=e.val().toLowerCase();t!=e.data("current-query")&&(e.closest(".customers-selector-search-w").addClass("os-loading"),e.data("searching-query",t),setTimeout((function(){if(t==jQuery(".customers-selector-search-input").data("searching-query")){var a={action:latepoint_helper.route_action,route_name:e.data("route"),params:{query:t},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(a){e.data("searching-query")==t&&(e.closest(".customers-selector-search-w").removeClass("os-loading"),"success"===a.status&&(e.data("current-query",t),jQuery(".quick-order-form-w .customers-options-list").html(a.message)))}})}}),300,t,e))}))}function latepoint_load_quick_availability(e,t=!1,a=!1,o=!1,i=!1){e.addClass("os-loading");let n=e.closest(".order-item-booking-data-form-wrapper");var s=n.find(".trigger-quick-availability").data("route"),r=jQuery(".quick-order-form-w");t&&r.find(".agent-selector").val(t),r.find(".service-selector").val()&&"0"!=r.find(".service-selector").val()||r.find(".os-services-select-field-w .service-option:first").trigger("click");let l=new FormData(r.find("form")[0]);l.set("trigger_form_booking_id",n.data("booking-id")),l.set("trigger_form_order_item_id",n.data("order-item-id")),a&&l.set("start_date",a),(o||i)&&l.set("show_days_only",!0),i&&l.set("previous_days",!0);var c={action:latepoint_helper.route_action,route_name:s,params:latepoint_formdata_to_url_encoded_string(l),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:c,success:function(t){e.removeClass("os-loading"),"success"===t.status?o?(jQuery(".latepoint-side-panel-w .quick-availability-per-day-w").html(t.message),jQuery(".latepoint-side-panel-w .os-availability-days").scrollTop(52)):i?(jQuery(".latepoint-side-panel-w .quick-availability-per-day-w").html(t.message),jQuery(".latepoint-side-panel-w .os-availability-days").scrollTop(jQuery(".latepoint-side-panel-w .os-availability-days")[0].scrollHeight-jQuery(".latepoint-side-panel-w .os-availability-days")[0].clientHeight-50)):(latepoint_display_in_side_sub_panel(t.message),jQuery(".latepoint-side-panel-w .os-availability-days").scrollTop(52),jQuery("body").addClass("has-side-sub-panel"),latepoint_init_quick_availability_form()):alert(t.message,"error")}})}function latepoint_create_field_base_name(e,t){return"order_items["+e+"][bookings]["+t+"]"}function latepoint_close_quick_availability_form(){jQuery(".quick-availability-per-day-w").remove(),jQuery("body").removeClass("has-side-sub-panel")}function latepoint_init_quick_availability_form(){let e=jQuery(".quick-availability-per-day-w"),t=e.data("trigger-form-order-item-id"),a=e.data("trigger-form-booking-id"),o=latepoint_create_field_base_name(t,a),i=jQuery('.quick-order-form-w .order-item-booking-data-form-wrapper[data-booking-id="'+a+'"]');var n=i.find('input[name="'+o+'[start_date_formatted]"').val(),s=latepoint_hours_and_minutes_to_minutes(i.find('input[name="'+o+'[start_time][formatted_value]"]').val(),i.find('input[name="'+o+'[start_time][ampm]"]').val());e.find(".os-availability-days").find('.agent-timeslot[data-formatted-date="'+n+'"][data-minutes="'+s+'"]').addClass("selected"),e.on("click",".load-more-quick-availability",(function(){jQuery(this).addClass("os-loading");let e=jQuery(this).closest(".quick-availability-per-day-w").data("trigger-form-booking-id");return latepoint_load_quick_availability(jQuery('.order-item-booking-data-form-wrapper[data-booking-id="'+e+'"]').find(".trigger-quick-availability"),!1,jQuery(this).data("start-date"),!0),!1})),e.on("click",".load-prev-quick-availability",(function(){jQuery(this).addClass("os-loading");let e=jQuery(this).closest(".quick-availability-per-day-w").data("trigger-form-booking-id");return latepoint_load_quick_availability(jQuery('.order-item-booking-data-form-wrapper[data-booking-id="'+e+'"]').find(".trigger-quick-availability"),!1,jQuery(this).data("start-date"),!1,!0),!1})),e.find('select[name="booking[agent_id]"]').on("change",(function(){latepoint_load_quick_availability(jQuery(".trigger-quick-availability"),jQuery(this).val())})),jQuery(".os-time-group label").on("click",(function(){jQuery(this).closest(".os-time-group").find(".os-form-control").trigger("focus")})),e.on("click",".fill-booking-time",(function(){jQuery(".os-availability-days .agent-timeslot.selected").removeClass("selected"),jQuery(this).addClass("selected");var e=jQuery(this).data("formatted-date"),t=jQuery(this).data("minutes");i.find('input[name="'+o+'[start_date_formatted]"]').val(e);var a=t,n=latepoint_minutes_to_hours_and_minutes(a);a>=720?i.find(".quick-start-time-w .time-pm").trigger("click"):i.find(".quick-start-time-w .time-am").trigger("click"),i.find('input[name="'+o+'[start_time][formatted_value]"]').val(n),latepoint_set_booking_end_time(i),i.find(".ws-period, .as-period").addClass("animate-filled-in"),setTimeout((function(){i.find(".ws-period, .as-period").removeClass("animate-filled-in")}),500)}))}function latepoint_reload_after_order_save(){latepoint_reload_calendar_view(),jQuery(".os-widget").each((function(){latepoint_reload_widget(jQuery(this))})),jQuery("table.os-reload-on-booking-update").length&&latepoint_filter_table(jQuery("table.os-reload-on-booking-update"),jQuery("table.os-reload-on-booking-update")),latepoint_close_side_panel()}jQuery,jQuery.fn.lateSelect=function(){function e(e){var t="";return e.data("quantity")&&(t='<span class="os-late-quantity-selector-w"><span class="os-late-quantity-selector minus" data-sign="minus"></span><input class="os-late-quantity-selector-input" type="text" data-max-quantity="'+e.data("max-quantity")+'" value="'+e.data("quantity")+'"/><span class="os-late-quantity-selector plus" data-sign="plus"></span></span>'),'<div class="ls-item" data-value="'+e.val()+'"><span class="latepoint-icon latepoint-icon-cross ls-item-remover"></span><span>'+e.text()+"</span>"+t+"</div>"}this.each((function(){var t,a="",o="",i="";if(!jQuery(this).hasClass("os-late-select-active")){jQuery(this).hide().addClass("os-late-select-active"),jQuery(this).find("option").each((function(){jQuery(this).is(":selected")&&(o+=e(jQuery(this))),i=jQuery(this).is(":selected")?"selected":"",a+='<div class="ls-item '+i+'" data-value="'+jQuery(this).val()+'">'+jQuery(this).text()+"</div>"}));var n='<div class="ls-placeholder">'+jQuery(this).data("placeholder")+"</div>";t=jQuery('<div class="lateselect-w"></div>'),jQuery(this).wrap(t);var s=jQuery(this).closest(".lateselect-w");s.append('<div class="ls-selected-items-w">'+n+o+"</div>"),s.append('<div class="ls-all-items-w">'+a+"</div>"),s.on("click",".ls-all-items-w .ls-item:not(.selected)",(function(){var t=jQuery(this).data("value");return s.find(".ls-selected-items-w").append(e(s.find('select option[value="'+t+'"]'))),jQuery(this).addClass("selected"),s.removeClass("ls-selecting"),s.find('select option[value="'+t+'"]').prop("selected",!0),s.find("select").trigger("change"),!1})),s.on("click",".ls-selected-items-w .ls-item-remover",(function(){var e=jQuery(this).closest(".ls-item").data("value");return jQuery(this).closest(".ls-item").remove(),s.find('.ls-all-items-w .ls-item.selected[data-value="'+e+'"]').removeClass("selected"),s.find('select option[value="'+e+'"]').prop("selected",!1),s.find("select").trigger("change"),!1})),s.on("click",".ls-selected-items-w",(function(){return s.toggleClass("ls-selecting"),!1})),s.on("click",".os-late-quantity-selector",(function(){var e=jQuery(this).closest(".ls-item").find("input.os-late-quantity-selector-input"),t=parseInt(e.val()),a="minus"==jQuery(this).data("sign")?t-1:t+1,o=e.data("max-quantity");a<=0&&(a=1),o&&a>o&&(a=o);var i=jQuery(this).closest(".ls-item").data("value");return s.find('select option[value="'+i+'"]').data("quantity",a),e.val(a),s.find("select").trigger("change"),!1})),jQuery(this).on("change",(function(){var e=!1;e=jQuery(this).data("hidden-connection")?jQuery(jQuery(this).data("hidden-connection")):jQuery(this).closest(".lateselect-w").next('input[type="hidden"]');var t="";jQuery(this).find("option:selected").length?jQuery(this).find("option:selected").each((function(){if(jQuery(this).data("quantity")){var e=jQuery(this).data("quantity")?jQuery(this).data("quantity"):1;t+=jQuery(this).val()+":"+e+","}else t+=jQuery(this).val()+","})):t="",""!=t&&(t=t.slice(0,-1)),e.val(t)}))}}))},jQuery,jQuery.fn.lateCheckbox=function(){function e(e){let t=jQuery('.latecheckbox-w[data-latecheckbox-id="'+e+'"]');t.find(".latecheckbox-options-w").html(jQuery('.latecheckbox-options-w[data-latecheckbox-id="'+e+'"]').html());let a=t.find(".latecheckbox-options"),o=a.find('.latecheckbox-option input[type="checkbox"]:checked').length;o<a.find('.latecheckbox-option input[type="checkbox"]').length?t.find(".latecheckbox .filter-value").text(o):t.find(".latecheckbox .filter-value").text("All"),t.find('input[type="checkbox"][indeterminate="indeterminate"]').prop("indeterminate",!0).removeAttr("indeterminate"),t.find(".latecheckbox").trigger("change")}this.each((function(){var t=jQuery(this).closest(".latecheckbox-w");t.attr("data-latecheckbox-id","latecheckbox-"+latepoint_random_generator()),t.on("click",".latecheckbox",(function(){if(jQuery(this),jQuery("body > .latecheckbox-options-w").remove(),jQuery(this).hasClass("is-active"))jQuery(this).removeClass("is-active");else{jQuery(".latecheckbox.is-active").removeClass("is-active"),jQuery(this).addClass("is-active");let a=jQuery(this).position(),o=a.left,i=t.find(".latecheckbox-options-w").clone();i.attr("data-latecheckbox-id",jQuery(this).closest(".latecheckbox-w").attr("data-latecheckbox-id")).appendTo("body"),o=o+jQuery(this).outerWidth()-i.outerWidth(),i.css({top:a.top+jQuery(this).outerHeight()+5,left:o}),i.find(".latecheckbox-filter-input").length&&i.find(".latecheckbox-filter-input").trigger("focus"),i.on("change",".latecheckbox-all-check",(function(){jQuery(this).is(":checked")?(jQuery(this).attr("checked","checked").removeAttr("indeterminate"),jQuery(this).closest(".latecheckbox-options-w").find('.latecheckbox-options input[type="checkbox"]').prop("checked",!0).prop("indeterminate",!1).attr("checked","checked")):(jQuery(this).removeAttr("checked").removeAttr("indeterminate"),jQuery(this).closest(".latecheckbox-options-w").find('.latecheckbox-options input[type="checkbox"]').prop("checked",!1).prop("indeterminate",!1).removeAttr("checked")),e(jQuery(this).closest(".latecheckbox-options-w").attr("data-latecheckbox-id"))})),i.on("change",".latecheckbox-group-check",(function(){jQuery(this).is(":checked")?(jQuery(this).attr("checked","checked").removeAttr("indeterminate"),jQuery(this).closest(".latecheckbox-group").find('.latecheckbox-group-options input[type="checkbox"]').prop("checked",!0).attr("checked","checked")):(jQuery(this).removeAttr("checked").removeAttr("indeterminate"),jQuery(this).closest(".latecheckbox-group").find('.latecheckbox-group-options input[type="checkbox"]').prop("checked",!1).removeAttr("checked")),e(jQuery(this).closest(".latecheckbox-options-w").attr("data-latecheckbox-id"))})),i.on("keyup",".latecheckbox-filter-input",(function(){let e=jQuery(this).val().toLowerCase();""==e?jQuery(this).closest(".latecheckbox-options-w").find(".latecheckbox-option.hidden").removeClass("hidden"):jQuery(this).closest(".latecheckbox-options-w").find(".latecheckbox-option").each((function(){jQuery(this).text().toLowerCase().indexOf(e)>=0?jQuery(this).removeClass("hidden"):jQuery(this).addClass("hidden")}))})),i.on("change",'.latecheckbox-option input[type="checkbox"]',(function(){if(jQuery(this).is(":checked")?jQuery(this).attr("checked","checked"):jQuery(this).removeAttr("checked"),jQuery(this).closest(".latecheckbox-group-options").length){let e=jQuery(this).closest(".latecheckbox-group"),t=e.find(".latecheckbox-option input:checked").length,a=e.find(".latecheckbox-option input:not(:checked)").length;t&&a?(e.find(".latecheckbox-group-check").prop("indeterminate",!0).attr("indeterminate","indeterminate"),e.find(".latecheckbox-group-check").prop("checked",!1).removeAttr("checked")):(e.find(".latecheckbox-group-check").prop("indeterminate",!1).removeAttr("indeterminate"),t||e.find(".latecheckbox-group-check").prop("checked",!1).removeAttr("checked"),a||e.find(".latecheckbox-group-check").prop("checked",!0).attr("checked","checked"))}let t=i.find(".latecheckbox-option input:checked").length,a=i.find(".latecheckbox-option input:not(:checked)").length;t&&a?(i.find(".latecheckbox-all-check").prop("indeterminate",!0).attr("indeterminate","indeterminate"),i.find(".latecheckbox-all-check").prop("checked",!1).removeAttr("checked")):(i.find(".latecheckbox-all-check").prop("indeterminate",!1).removeAttr("indeterminate"),t||i.find(".latecheckbox-all-check").prop("checked",!1).removeAttr("checked"),a||i.find(".latecheckbox-all-check").prop("checked",!0).attr("checked","checked")),e(jQuery(this).closest(".latecheckbox-options-w").attr("data-latecheckbox-id"))}))}return!1}))}))},jQuery((function($){$(".latepoint").find("[data-os-action-onload]").length&&$(".latepoint").find("[data-os-action-onload]").each((function(){var e=jQuery(this);e.addClass("os-loading");var t=e.data("os-params"),a=e.data("os-return-format")?e.data("os-return-format"):"json",o={action:"latepoint_route_call",route_name:e.data("os-action-onload"),params:t,return_format:a};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:function(t){e.removeClass("os-loading"),"success"===t.status&&"self"==e.data("os-output-target")&&e.html(t.message)}})})),jQuery("body.latepoint").on("change","select[data-os-on-change]",(function(e){let t=jQuery(this),a=t.data("os-on-change");if(a.includes(".")){let e=a.split(".");"function"!=typeof window[e[0]][e[1]]?console.log(a+" is undefined"):window[e[0]][e[1]](t)}else"function"!=typeof window[a]?console.log(a+" is undefined"):window[a](t)})),$(".latepoint").on("click","button[data-os-action], a[data-os-action], div[data-os-action], span[data-os-action], tr[data-os-action]",(function(e){var t=jQuery(this);if(t.data("os-prompt")&&!confirm(t.data("os-prompt")))return!1;var a=t.data("os-params");t.data("os-source-of-params")&&(a=latepoint_formdata_to_url_encoded_string(latepoint_create_form_data_from_non_form_element($(t.data("os-source-of-params")))));var o=t.data("os-return-format")?t.data("os-return-format"):"json",i={action:"latepoint_route_call",route_name:t.data("os-action"),params:a,return_format:o};if(t.addClass("os-loading"),"side-panel"==t.data("os-output-target")){$(".latepoint-side-panel-w").remove();let e=t.data("os-lightbox-classes")?t.data("os-lightbox-classes"):"";$("body").append('<div class="latepoint-side-panel-w '+e+' os-loading"><div class="latepoint-side-panel-shadow"></div><div class="latepoint-side-panels"><div class="latepoint-side-panel-i"></div></div></div>')}else"full-panel"==t.data("os-output-target")&&($(".latepoint-full-panel-w").remove(),$("body").append('<div class="latepoint-full-panel-w os-loading"></div>'));return $.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:i,success:function(e){if("success"===e.status){if("lightbox"==t.data("os-output-target"))latepoint_show_data_in_lightbox(e.message,t.data("os-lightbox-classes"),"yes"!==t.data("os-lightbox-no-close-button"),t.data("os-lightbox-tag"),t.data("os-lightbox-inner-classes"),t.data("os-lightbox-inner-tag"));else if("side-panel"==t.data("os-output-target"))$(".latepoint-side-panel-i").html(e.message),jQuery(".latepoint-side-panel-i").find(".os-form-header .latepoint-side-panel-close").remove(),jQuery(".latepoint-side-panel-i").find(".os-form-header").append('<a href="#" class="latepoint-side-panel-close latepoint-side-panel-close-trigger"><i class="latepoint-icon latepoint-icon-x"></i></a>'),setTimeout((function(){$(".latepoint-side-panel-w").removeClass("os-loading")}),100);else if("full-panel"==t.data("os-output-target"))$(".latepoint-full-panel-w").html(e.message),setTimeout((function(){$(".latepoint-full-panel-w").removeClass("os-loading")}),100);else{if("reload"==t.data("os-success-action"))return latepoint_add_notification(e.message),void location.reload();if("redirect"==t.data("os-success-action"))return void(t.data("os-redirect-to")?(latepoint_add_notification(e.message),window.location.replace(t.data("os-redirect-to"))):window.location.replace(e.message));if(t.data("os-output-target")&&$(t.data("os-output-target")).length)"append"==t.data("os-output-target-do")?$(t.data("os-output-target")).append(e.message):"prepend"==t.data("os-output-target-do")?$(t.data("os-output-target")).prepend(e.message):$(t.data("os-output-target")).html(e.message);else switch(t.data("os-before-after")){case"before":t.before(e.message);break;case"after":t.after(e.message);break;case"replace":t.replaceWith(e.message);break;case"none":break;default:latepoint_add_notification(e.message)}}if(t.data("os-after-call")){if((o=t.data("os-after-call")).includes(".")){var a=o.split(".");"function"!=typeof window[a[0]][a[1]]&&console.log(o+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[a[0]][a[1]](t,e):t.data("os-pass-this")?window[a[0]][a[1]](t):t.data("os-pass-response")?window[a[0]][a[1]](e):window[a[0]][a[1]]()}else"function"!=typeof window[o]&&console.log(o+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[o](t,e):t.data("os-pass-this")?window[o](t):t.data("os-pass-response")?window[o](e):window[o]()}t.removeClass("os-loading")}else if(t.removeClass("os-loading"),t.data("os-output-target")&&$(t.data("os-output-target")).length?$(t.data("os-output-target")).prepend(latepoint_generate_form_message_html(e.message,"error")):alert(e.message),t.data("os-after-call-error")){var o;if((o=t.data("os-after-call-error")).includes(".")){a=o.split(".");"function"!=typeof window[a[0]][a[1]]&&console.log(o+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[a[0]][a[1]](t,e):t.data("os-pass-this")?window[a[0]][a[1]](t):t.data("os-pass-response")?window[a[0]][a[1]](e):window[a[0]][a[1]]()}else"function"!=typeof window[o]&&console.log(o+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[o](t,e):t.data("os-pass-this")?window[o](t):t.data("os-pass-response")?window[o](e):window[o]()}}}),!1})),$(".latepoint").on("click",'form[data-os-action] button[type="submit"]',(function(e){$(this).addClass("os-loading")})),$(".latepoint").on("submit","form[data-os-action]",(function(e){e.preventDefault();var t=$(this),a=new FormData(t[0]);"lp_intlTelInputGlobals"in window&&"lp_intlTelInputUtils"in window&&t.find("input.os-mask-phone").each((function(){if(window.lp_intlTelInputGlobals.getInstance(this)){const e=this.getAttribute("name"),t=window.lp_intlTelInputGlobals.getInstance(this).getNumber(window.lp_intlTelInputUtils.numberFormat.E164);a.set(e,t)}}));let o=latepoint_create_form_data(t,$(this).data("os-action"));return t.find('button[type="submit"]').addClass("os-loading"),$.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:o,success:function(e){if(t.find('button[type="submit"].os-loading').removeClass("os-loading"),latepoint_clear_form_messages(t),"success"===e.status){if("reload"==t.data("os-success-action"))return latepoint_add_notification(e.message),void location.reload();if("redirect"==t.data("os-success-action"))return void(t.data("os-redirect-to")?(latepoint_add_notification(e.message),window.location.replace(t.data("os-redirect-to"))):window.location.replace(e.message));if(t.data("os-output-target")&&$(t.data("os-output-target")).length?$(t.data("os-output-target")).html(e.message):"redirect"==e.message?window.location.replace(e.url):latepoint_add_notification(e.message),t.data("os-record-id-holder")&&e.record_id&&t.find('[name="'+t.data("os-record-id-holder")+'"]').val(e.record_id),t.data("os-after-call")){var a=t.data("os-after-call");if(a.includes(".")){var o=a.split(".");"function"!=typeof window[o[0]][o[1]]&&console.log(a+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[o[0]][o[1]](t,e):t.data("os-pass-this")?window[o[0]][o[1]](t):t.data("os-pass-response")?window[o[0]][o[1]](e):window[o[0]][o[1]]()}else"function"!=typeof window[a]&&console.log(a+" is undefined"),t.data("os-pass-this")&&t.data("os-pass-response")?window[a](t,e):t.data("os-pass-this")?window[a](t):t.data("os-pass-response")?window[a](e):window[a]()}$("button.os-loading").removeClass("os-loading")}else $("button.os-loading").removeClass("os-loading"),t.data("os-show-errors-as-notification")?latepoint_add_notification(e.message,"error"):(latepoint_add_notification(e.message,"error"),$([document.documentElement,document.body]).animate({scrollTop:t.find(".os-form-message-w").offset().top-30},200));e.form_values_to_update&&$.each(e.form_values_to_update,(function(e,a){t.find('[name="'+e+'"]').val(a)}))}}),!1}))})),jQuery(document).ready((function($){latepoint_check_for_updates(),jQuery("body").on("click",".addon-category-filter-trigger",(function(){if(jQuery(".addons-categories-wrapper .addon-category-filter-trigger.is-selected").removeClass("is-selected"),jQuery(this).data("category")){let e=jQuery(this).data("category").toString();jQuery(".addon-box").addClass("hidden"),jQuery(".addon-box").each((function(){jQuery(this).data("category").toString().split(",").includes(e)&&jQuery(this).removeClass("hidden")}))}else jQuery(".addon-box").removeClass("hidden");return jQuery(this).addClass("is-selected"),!1})),jQuery(".addons-info-holder").on("click",".os-addon-action-btn",(function(){var e=jQuery(this);e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route-name"),params:{addon_name:e.data("addon-name"),addon_path:e.data("addon-path")},layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:function(t){e.removeClass("os-loading"),"success"===t.status?(latepoint_add_notification(t.message),latepoint_load_addons_info()):"404"==t.code?latepoint_show_data_in_lightbox(t.message):alert(t.message)}}),!1}))}));class LatepointStripeConnectAdmin{constructor(){this.ready()}ready(){jQuery(document).ready((()=>{jQuery(".stripe-connect-status-wrapper").on("click",".payment-start-connecting",(function(){let e=jQuery(this);e.addClass("os-loading");var t={action:"latepoint_route_call",route_name:e.data("route-name"),params:{env:e.data("env")},layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:t,success:e=>{window.location.href=e.url}}),!1})),jQuery(".stripe-connect-status-wrapper").length&&jQuery(".stripe-connect-status-wrapper").each(((e,t)=>{let a=jQuery(t);var o={action:"latepoint_route_call",route_name:a.data("route-name"),params:{env:a.data("env")},layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:e=>{this.reload_connect_status_wrapper(a,e)}})}))}))}reload_connect_status_wrapper(e,t){"success"===t.status?e.hasClass(".stripe-connect-status-wrapper")?e.html(t.message):e.closest(".stripe-connect-status-wrapper").html(t.message):alert(t.message)}}window.latepointStripeConnectAdmin=new LatepointStripeConnectAdmin,jQuery(document).ready((function($){latepoint_init_calendars(),latepoint_init_circles_charts(),latepoint_init_donut_charts(),latepoint_init_daily_bookings_chart(),latepoint_init_element_togglers(),latepoint_init_daterangepicker(jQuery(".os-date-range-picker")),latepoint_init_monthly_view(),latepoint_init_form_blocks(),latepoint_init_reminders_form(),latepoint_init_coupons_form(),latepoint_init_copy_on_click_elements(),latepoint_init_side_menu(),latepoint_init_color_picker(),latepoint_init_clickable_cells(),latepoint_init_input_masks(),latepoint_init_process_forms(),latepoint_init_sticky_side_menu(),latepoint_init_sortable_columns(),latepoint_init_accordions(),latepoint_init_default_form_fields_settings(),latepoint_init_steps_settings(),latepoint_init_booking_form_preview(),latepoint_init_sticky_side_nav(),latepoint_init_version5_intro(),jQuery(document).on({mouseenter:function(){let e=jQuery(this),t=e.offset();jQuery("body > .late-tooltip").remove();let a=jQuery("<div/>").addClass("late-tooltip").text(e.data("late-tooltip")).appendTo(jQuery("body"));return a.css("top",t.top-2),a.css("left",t.left+e.outerWidth()/2),!1},mouseleave:function(){jQuery("body > .late-tooltip").remove()}},"[data-late-tooltip]"),jQuery("body").on("click",".disabled-items-open-trigger",(function(){return jQuery(this).closest(".disabled-items-wrapper").toggleClass("is-open"),!1})),jQuery("body").on("click",".latepoint-side-panel-close",(function(){return jQuery(".side-sub-panel-wrapper").remove(),!1})),jQuery("#settings_list_of_phone_countries").on("change",(function(){jQuery(this).val()==latepoint_helper.value_all?jQuery(".select-phone-countries-wrapper").hide():jQuery(".select-phone-countries-wrapper").show()})),jQuery(".os-select-all-toggler").on("change",(function(){var e=jQuery(this).closest(".white-box").find(".os-complex-connections-selector .connection");return jQuery(this).is(":checked")?latepoint_complex_selector_select(e):latepoint_complex_selector_deselect(e),!1})),jQuery(".os-main-location-selector").on("change",(function(){var e=jQuery(this).data("route"),t="id="+jQuery(this).val(),a={action:latepoint_helper.route_action,route_name:e,params:t,layout:"none",return_format:"json"};jQuery(".latepoint-content-w").addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(e){location.reload()}})})),jQuery(".os-service-durations-w").on("click",".os-remove-duration",(function(){return jQuery(this).closest(".duration-box").slideUp(300,(function(){jQuery(this).remove()})),!1})),jQuery(".menu-color-toggler").on("click",(function(){return jQuery(".latepoint-side-menu-w").toggleClass("dark"),!1})),jQuery(".latepoint-mobile-top-menu-trigger").on("click",(function(){return jQuery(this).closest(".latepoint-all-wrapper").toggleClass("os-show-mobile-menu"),jQuery(this).closest(".latepoint-all-wrapper").hasClass("os-show-mobile-menu")?jQuery(".latepoint-side-menu-w ul.side-menu > li.has-children > a").on("click",(function(){return jQuery(this).closest("li").toggleClass("menu-item-sub-open-mobile"),!1})):jQuery(".latepoint-side-menu-w ul.side-menu > li.has-children > a").off("click"),!1})),jQuery(".latepoint-mobile-top-search-trigger-cancel").on("click",(function(){return jQuery(this).closest(".latepoint-all-wrapper").removeClass("os-show-mobile-search"),!1})),jQuery(".latepoint-mobile-top-search-trigger").on("click",(function(){return jQuery(this).closest(".latepoint-all-wrapper").toggleClass("os-show-mobile-search"),jQuery(this).closest(".latepoint-all-wrapper").hasClass("os-show-mobile-search")&&jQuery(".latepoint-top-search").trigger("focus"),!1})),jQuery(".latepoint-top-bar-w").on("click",".top-user-info-toggler",(function(){return jQuery(".latepoint-user-info-dropdown").toggleClass("os-visible"),!1})),jQuery(".latepoint-content").on("click",".mobile-calendar-actions-trigger",(function(){return jQuery(this).closest(".calendar-mobile-controls").toggleClass("os-show-actions"),!1})),jQuery(".latepoint-content").on("click",".os-widget-header-actions-trigger",(function(){return jQuery(this).closest(".os-widget-header").toggleClass("os-show-actions"),!1})),jQuery(".latepoint-content").on("click",".mobile-table-actions-trigger",(function(){return jQuery(this).closest(".os-pagination-w").toggleClass("os-show-actions"),!1})),jQuery(".download-csv-with-filters").on("click",(function(){var e=jQuery(this).closest(".table-with-pagination-w").find(".os-table-filter").serialize();e+="&download=csv",jQuery(this).attr("href",this.href+"&"+e)})),jQuery("select.pagination-page-select").on("change",(function(){latepoint_filter_table(jQuery(this).closest(".table-with-pagination-w").find("table"),jQuery(this).closest(".pagination-page-select-w"),!1)})),jQuery("select.os-table-filter").on("change",(function(){latepoint_filter_table(jQuery(this).closest("table"),jQuery(this).closest(".os-form-group"))})),jQuery("input.os-table-filter").on("keyup",(function(){latepoint_filter_table(jQuery(this).closest("table"),jQuery(this).closest(".os-form-group"))})),jQuery(".customize-connection-btn").on("click",(function(){return jQuery(this).closest(".connection").toggleClass("show-customize-box"),!1})),jQuery(".connection-children-list").on("click","li",(function(){return jQuery(this).hasClass("active")?(jQuery(this).removeClass("active"),jQuery(this).find("input.connection-child-is-connected").val("no")):(jQuery(this).addClass("active"),jQuery(this).find("input.connection-child-is-connected").val("yes")),latepoint_count_active_connections(jQuery(this).closest(".connection")),!1})),jQuery(".display-toggler-control").on("change",(function(){let e=jQuery(this).data("toggler-group"),t=jQuery(this).val();return jQuery('.display-toggler-target[data-toggler-group="'+e+'"]').hide(),jQuery('.display-toggler-target[data-toggler-group="'+e+'"][data-toggler-key="'+t+'"]').show(),!1})),jQuery(".add-item-category-trigger").on("click",(function(){return jQuery(".add-item-category-box").toggle(),jQuery(".os-new-item-category-form-w").toggle(),!1})),jQuery(".latepoint-top-search").on("keyup",(function(e){var t=jQuery(this).closest(".latepoint-top-search-w");t.addClass("os-loading");var a=jQuery(this).val();if(27==e.keyCode)return t.removeClass("typing"),jQuery(".latepoint-top-search-results-w").html(""),jQuery(this).val(""),void t.removeClass("os-loading");if(""==a)return t.removeClass("typing"),jQuery(".latepoint-top-search-results-w").html(""),void t.removeClass("os-loading");var o=jQuery(this).data("route"),i="query="+a,n={action:latepoint_helper.route_action,route_name:o,params:i,layout:"none",return_format:"json"};t.addClass("typing"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:function(e){t.hasClass("typing")&&(t.removeClass("os-loading"),"success"===e.status&&jQuery(".latepoint-top-search-results-w").html(e.message))}})})),jQuery(".appointment-status-selector").on("click",(function(e){e.stopPropagation()})),jQuery(".latepoint-show-license-details").on("click",(function(e){return jQuery(this).closest(".active-license-info").find(".license-info-w").slideToggle(200),!1})),jQuery(".aba-button-w").on("click",(function(e){e.stopPropagation();var t=jQuery(this).hasClass("aba-approve")?latepoint_helper.approve_confirm:latepoint_helper.reject_confirm
;confirm(t)&&jQuery(this).closest(".appointment-box-large").find(".appointment-status-selector select").val(jQuery(this).data("status")).trigger("change");return!1})),jQuery(".appointment-status-selector select").on("change",(function(e){var t=jQuery(this).closest(".appointment-status-selector"),a=t.data("route"),o=t.data("wp-nonce"),i=t.data("booking-id"),n=jQuery(this).val();jQuery(this).closest(".appointment-box-large").attr("class","appointment-box-large status-"+n);var s="id="+i+"&status="+n+"&_wpnonce="+o,r={action:latepoint_helper.route_action,route_name:a,params:s,layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:r,success:function(e){"success"===e.status?latepoint_add_notification(e.message):latepoint_add_notification(e.message,"error")}})})),jQuery("body").on("click",".open-template-variables-panel",(function(){return jQuery(".latepoint-template-variables").toggleClass("is-visible"),!1})),jQuery("body").on("click",".close-template-variables-panel",(function(){return jQuery(".latepoint-template-variables").removeClass("is-visible"),!1})),jQuery("body").on("click",".open-layout-template-variables-panel",(function(){return jQuery(".latepoint-layout-template-variables").toggleClass("is-visible"),!1})),jQuery("body").on("click",".close-layout-template-variables-panel",(function(){return jQuery(".latepoint-layout-template-variables").removeClass("is-visible"),!1})),jQuery("body").on("click",".os-notifications .os-notification-close",(function(){return jQuery(this).closest(".item").remove(),!1})),jQuery("body").on("keyup",".os-form-group .os-form-control",(function(){jQuery(this).val()?jQuery(this).closest(".os-form-group").addClass("has-value"):jQuery(this).closest(".os-form-group").removeClass("has-value")})),jQuery(".os-wizard-setup-w, .latepoint-settings-w, .custom-schedule-wrapper").on("click",".ws-head",(function(){var e=jQuery(this).closest(".weekday-schedule-w");e.toggleClass("is-editing").removeClass("day-off"),e.find(".os-toggler").removeClass("off"),e.find("input.is-active").val(1)})),jQuery("body.latepoint").on("click",".wizard-add-edit-item-trigger",(function(e){jQuery(this).addClass("os-loading");var t=jQuery(this).data("route"),a={};jQuery(this).data("id")&&(a.id=jQuery(this).data("id"));var o={action:latepoint_helper.route_action,route_name:t,params:a,layout:"none",return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:function(e){jQuery(".wizard-add-edit-item-trigger.os-loading").removeClass("os-loading"),"success"===e.status&&(jQuery(".os-wizard-step-content-i").html(e.message),jQuery(".os-wizard-setup-w").addClass("is-sub-editing"),jQuery(".os-wizard-footer").hide(),latepoint_init_wizard_content())}})})),jQuery("body.latepoint").on("click",".os-wizard-trigger-next-btn",(function(){var e=jQuery(this);e.addClass("os-loading");var t=jQuery("#wizard_current_step_code").val(),a="current_step_code="+t;if(jQuery(".os-wizard-setup-w form.weekday-schedules-w").length&&(a+="&"+jQuery(".os-wizard-setup-w form.weekday-schedules-w .weekday-schedule-w:not(.day-off) input").serialize()),jQuery(".os-wizard-default-agent-form").length){a+="&"+jQuery(".os-wizard-default-agent-form input").serialize();var o=$(".os-wizard-default-agent-form"),i=new FormData(o[0]);i.set("current_step_code",t),"lp_intlTelInputGlobals"in window&&"lp_intlTelInputUtils"in window&&o.find("input.os-mask-phone").each((function(){if(window.lp_intlTelInputGlobals.getInstance(this)){const e=this.getAttribute("name"),t=window.lp_intlTelInputGlobals.getInstance(this).getNumber(window.lp_intlTelInputUtils.numberFormat.E164);i.set(e,t)}})),a=latepoint_formdata_to_url_encoded_string(i)}var n={action:latepoint_helper.route_action,route_name:jQuery(this).data("route-name"),params:a,layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:n,success:function(t){e.removeClass("os-loading"),"success"===t.status&&(jQuery("#wizard_current_step_code").val(t.step_code),jQuery(".os-wizard-setup-w").attr("class","os-wizard-setup-w step-"+t.step_code),jQuery(".os-wizard-step-content").html(t.message),latepoint_init_wizard_content(),t.show_prev_btn?jQuery(".os-wizard-prev-btn").show():jQuery(".os-wizard-prev-btn").hide(),t.show_next_btn?jQuery(".os-wizard-next-btn").show():jQuery(".os-wizard-next-btn").hide(),t.show_next_btn||t.show_prev_btn?jQuery(".os-wizard-footer").show():jQuery(".os-wizard-footer").hide())}}),!1})),jQuery("body.latepoint").on("click",".os-wizard-trigger-prev-btn",(function(){var e=jQuery(this);e.addClass("os-loading");var t="current_step_code="+jQuery("#wizard_current_step_code").val(),a={action:latepoint_helper.route_action,route_name:jQuery(this).data("route-name"),params:t,layout:"none",return_format:"json"};return jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:a,success:function(t){e.removeClass("os-loading"),"success"===t.status&&(jQuery("#wizard_current_step_code").val(t.step_code),jQuery(".os-wizard-setup-w").attr("class","os-wizard-setup-w step-"+t.step_code),jQuery(".os-wizard-step-content").html(t.message),latepoint_init_wizard_content(),t.show_prev_btn?jQuery(".os-wizard-prev-btn").show():jQuery(".os-wizard-prev-btn").hide(),t.show_next_btn?jQuery(".os-wizard-next-btn").show():jQuery(".os-wizard-next-btn").hide(),t.show_next_btn||t.show_prev_btn?jQuery(".os-wizard-footer").show():jQuery(".os-wizard-footer").hide())}}),!1})),jQuery(".latepoint-content-w").on("change",".os-widget .os-trigger-reload-widget",(function(){latepoint_reload_widget(jQuery(this).closest(".os-widget"))})),jQuery(".latepoint-content-w").on("click",".os-widget .timeline-type-toggle .timeline-type-option",(function(){jQuery(this).closest(".timeline-type-toggle").find(".timeline-type-option.active").removeClass("active"),jQuery(this).addClass("active"),jQuery(".timeline-and-availability-contents").removeClass("shows-appointments shows-availability").addClass("shows-"+jQuery(this).data("value")),jQuery("#"+jQuery(this).closest(".timeline-type-toggle").data("value-holder-id")).val(jQuery(this).data("value"))})),dragula([].slice.apply(document.querySelectorAll(".os-categories-ordering-w .os-category-children")),{moves:function(e,t,a){return a.classList.contains("os-category-drag")||a.classList.contains("os-category-item-drag")}}).on("drop",(function(e){var t=jQuery(".os-categories-ordering-w"),a=[],o=[];t.find(".os-category-parent-w").each((function(e){var t=jQuery(this).index()+1,o=jQuery(this).parent().closest(".os-category-parent-w").data("id")||0;a.push({id:jQuery(this).data("id"),order_number:t,parent_id:o})})),t.find(".item-in-category-w").each((function(e){var t=jQuery(this).index()+1,a=jQuery(this).closest(".os-category-parent-w").data("id")||0;o.push({id:jQuery(this).data("id"),order_number:t,category_id:a})})),latepoint_recalculate_items_count_in_category();var i={action:latepoint_helper.route_action,route_name:t.data("category-order-update-route"),params:{category_datas:a,item_datas:o},return_format:"json"};t.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:i,success:function(e){t.removeClass("os-loading"),"success"===e.status||alert(e.message)}})})),dragula([jQuery(".os-draggable-form-blocks")[0]],{moves:function(e,t,a){return a.classList.contains("os-form-block-drag")}}).on("drop",(function(e){var t={},a=jQuery(".os-draggable-form-blocks");a.find(".os-form-block").each((function(e){var a=jQuery(this).index()+1,o=jQuery(this).find(".os-form-block-id");o.length&&o.val()&&(t[o.val()]=a)}));var o={action:latepoint_helper.route_action,route_name:a.data("order-update-route"),params:{ordered_fields:t,fields_for:a.data("fields-for")},return_format:"json"};a.addClass("os-loading"),jQuery.ajax({type:"post",dataType:"json",url:latepoint_timestamped_ajaxurl(),data:o,success:function(e){a.removeClass("os-loading")}})})),jQuery("body.latepoint-admin").on("click",".os-category-edit-btn, .os-category-edit-cancel-btn, .os-category-w .os-category-name",(function(){return jQuery(this).closest(".os-category-w").toggleClass("editing"),!1})),jQuery("body.latepoint-admin").on("click",".step-edit-btn, .step-edit-cancel-btn, .step-w .step-head",(function(){return jQuery(this).closest(".step-w").toggleClass("editing"),!1})),jQuery("body.latepoint-admin").on("click",".agent-info-change-agent-btn",(function(){return jQuery(this).closest(".agent-info-w").removeClass("selected").addClass("selecting"),!1})),jQuery("body.latepoint-admin").on("click",".agent-info-change-agent-btn",(function(){return jQuery(this).closest(".agent-info-w").removeClass("selected").addClass("selecting"),!1})),jQuery("body.latepoint-admin").on("click",".customer-info-create-btn",(function(){return jQuery(this).closest(".customer-info-w").removeClass("selecting").addClass("selected"),!1})),jQuery("body.latepoint-admin").on("click",".customer-info-load-btn",(function(){return jQuery(this).closest(".customer-info-w").removeClass("selected").addClass("selecting").find(".customers-selector-search-input").trigger("focus"),!1})),jQuery("body.latepoint-admin").on("click",".customers-selector-cancel",(function(){return jQuery(this).closest(".customer-info-w").removeClass("selecting").addClass("selected "),jQuery(".customers-options-list .customer-option").show(),jQuery(".customers-selector-search-input").val(""),!1})),jQuery("body.latepoint-admin").on("click",".service-option-selected",(function(){var e=jQuery(this).closest(".os-services-select-field-w");return e.hasClass("active")?e.removeClass("active"):e.addClass("active").find("input").trigger("focus"),!1})),jQuery("body.latepoint-admin").on("keyup",".service-options-filter-input",(function(){var e=jQuery(this).closest(".services-options-list"),t=jQuery(this).val().toLowerCase();return e.find(".service-option").hide(),e.find(".service-option").each((function(){-1!=jQuery(this).text().toLowerCase().indexOf(""+t)&&jQuery(this).show()})),!1})),jQuery(".calendar-week-agent-w").on("click",".calendar-load-target-date",(function(e){return jQuery(this).addClass("os-loading"),latepoint_reload_week_view_calendar(jQuery(this).data("target-date")),!1})),jQuery(".calendar-week-agent-w").on("change",".cc-availability-toggler #overlay_service_availability",(function(e){"on"==jQuery(this).val()?jQuery(".calendar-week-agent-w .cc-service-selector").show():jQuery(".calendar-week-agent-w .cc-service-selector").hide(),latepoint_reload_week_view_calendar()})),jQuery(".calendar-week-agent-w").on("change",".trigger-weekly-calendar-reload",(function(e){return latepoint_reload_week_view_calendar(),!1})),jQuery(".latepoint-admin").on("click",".os-complex-connections-selector .selector-trigger",(function(e){var t=jQuery(this).closest(".connection");return t.hasClass("active")?(latepoint_complex_selector_deselect(t),jQuery(this).closest(".white-box").find(".os-select-all-toggler").prop("checked",!1)):latepoint_complex_selector_select(t),!1})),jQuery(".latepoint-admin").on("click",".os-complex-connections-selector .item-quantity-selector",(function(e){let t=parseInt(jQuery(this).closest(".item-quantity-selector-w").find(".item-quantity-selector-input").val());return"plus"==jQuery(this).data("sign")?t+=1:t-=1,t=t>0?t:0,jQuery(this).closest(".item-quantity-selector-w").find(".item-quantity-selector-input").val(t).trigger("change"),!1})),jQuery(".latepoint-admin").on("change",".os-complex-connections-selector .item-quantity-selector-input",(function(e){let t=jQuery(this),a=jQuery(this).closest(".connection");return t.val()>0?latepoint_complex_selector_select(a,t.val()):latepoint_complex_selector_deselect(a),!1})),jQuery(".latepoint-admin").on("click",".os-agents-selector .agent",(function(){return jQuery(this).hasClass("active")?(jQuery(this).removeClass("active"),jQuery(this).find(".connection-child-is-connected").val("no")):(jQuery(this).addClass("active"),jQuery(this).find(".connection-child-is-connected").val("yes")),!1})),jQuery(".latepoint-admin").on("click",".os-services-selector .service",(function(){return jQuery(this).hasClass("active")?(jQuery(this).removeClass("active"),jQuery(this).find(".connection-child-is-connected").val("no")):(jQuery(this).addClass("active"),jQuery(this).find(".connection-child-is-connected").val("yes")),!1})),jQuery(".latepoint-admin").on("click",".os-form-toggler-group",(function(e){return jQuery(this).find(".os-toggler").trigger("click"),!1})),jQuery(".latepoint-admin").on("click",".os-toggler",(function(e){let t=jQuery(this);if(t.data("confirm")&&!confirm(t.data("confirm")))return!1;if(t.hasClass("on")?t.removeClass("on").addClass("off"):t.removeClass("off").addClass("on"),t.data("for"))if(t.hasClass("os-toggler-radio")){let e=jQuery("#"+t.data("for"));jQuery('input[type="radio"][name="'+e.prop("name")+'"]:checked').each((function(e){let t=jQuery(this).prop("checked",!1).closest(".os-toggler-w").find(".os-toggler.on").removeClass("on").addClass("off").data("controlled-toggle-id");jQuery("#"+t).hide()})),e.prop("checked",!t.hasClass("off"))}else{var a=jQuery('input[type="hidden"]#'+t.data("for"));if(a.length){if(t.data("is-string-value")?a.val(t.hasClass("off")?"off":"on").trigger("change"):a.val(t.hasClass("off")?0:1).trigger("change"),t.data("os-instant-update")){let e=new FormData,o=a.serialize();t.data("nonce")&&(o+="&_wpnonce="+t.data("nonce")),e.append("params",o),e.append("action",latepoint_helper.route_action),e.append("route_name",t.data("os-instant-update")),e.append("return_format","json"),jQuery.ajax({type:"post",dataType:"json",processData:!1,contentType:!1,url:latepoint_timestamped_ajaxurl(),data:e,success:function(e){}})}}else jQuery("#"+t.data("for")).prop("checked",!t.hasClass("off"))}return t.data("controlled-toggle-id")&&(t.hasClass("off")?jQuery("#"+t.data("controlled-toggle-id")).hide():jQuery("#"+t.data("controlled-toggle-id")).show()),t.data("negative-controlled-toggle-id")&&(t.hasClass("off")?jQuery("#"+t.data("negative-controlled-toggle-id")).show():jQuery("#"+t.data("negative-controlled-toggle-id")).hide()),t.trigger("ostoggler:toggle"),!1})),jQuery(".latepoint-admin").on("click",".os-image-selector-trigger",(function(e){var t;e.preventDefault();var a=jQuery(this),o=jQuery(this).closest(".os-image-selector-w"),i=o.find(".os-image-container"),n=o.find(".os-image-id-holder");let s=o.hasClass("is-avatar");if(s?i.find(".image-self").length:i.find("img").length)n.val(""),o.removeClass("has-image"),i.html(""),a.find(".os-text-holder").text(a.data("label-set-str"));else{if(t)return t.open(),!1;(t=wp.media({title:"Select or Upload Media",button:{text:"Use this media"},multiple:!1})).on("select",(function(){var e=t.state().get("selection").first().toJSON();s?i.html('<div class="image-self" style="background-image: url('+e.url+')"></div>'):i.html('<img src="'+e.url+'" alt=""/>'),n.val(e.id),o.addClass("has-image"),a.find(".os-text-holder").text(a.data("label-remove-str"))})),t.open()}return!1})),jQuery(".latepoint-admin").on("click",".os-multiple-files-uploader a",(function(e){e.stopPropagation()})),jQuery(".latepoint-admin").on("click",".os-multiple-files-uploader",(function(e){var t;e.preventDefault();var a=jQuery(this),o=a.closest(".os-multiple-files-uploader"),i=o.find(".os-uploaded-files-list"),n=o.find(".os-file-ids-holder");return(t=wp.media({title:"Select or Upload Files",button:{text:"Add selected files"},multiple:"add"})).on("select",(function(){var e=t.state().get("selection").map((function(e){return e=e.toJSON()})),o=n.val()?n.val().split(","):[];e.forEach((function(e){if(-1===o.indexOf(e.id.toString())){o.push(e.id);var t=jQuery('<div class="os-uploaded-file" data-file-id="'+e.id+'">');t.append('<a class="os-file-link" href="'+e.url+'" target="_blank">'+e.filename+"</a>"),t.append('<a href="#" class="os-remove-file" title="'+a.data("label-remove-str")+'"><i class="latepoint-icon latepoint-icon-cross"></i></a>'),i.append(t)}})),n.val(o.join(","))})),t.open(),!1})),jQuery(".latepoint-admin").on("click",".os-remove-file",(function(e){e.preventDefault();let t=jQuery(this);const a=t.closest(".os-uploaded-files-list").data("confirm-text")||"Are you sure you want to remove this file?";if(confirm(a)){let e=t.closest(".os-uploaded-file"),a=e.closest(".os-multiple-files-uploader").find(".os-file-ids-holder"),o=e.data("file-id"),i=a.val()?a.val().split(","):[];i=i.filter((function(e){return e!=o})),a.val(i.join(",")),e.remove()}})),jQuery("body").on("click",".latepoint-lightbox-close",(function(){return latepoint_lightbox_close(),!1})),jQuery("body").on("click",".latepoint-side-panel-close-trigger",(function(){return latepoint_close_side_panel(),!1})),jQuery("body").on("click",".latepoint-side-sub-panel-close-trigger",(function(){return jQuery(this).closest(".side-sub-panel-wrapper").remove(),!1})),jQuery("body.latepoint-admin").on("click",".time-ampm-select",(function(){let e=jQuery(this).closest(".order-item-booking-data-form-wrapper");jQuery(this).closest(".time-ampm-w").find(".active").removeClass("active"),jQuery(this).addClass("active");var t=jQuery(this).data("ampm-value");return jQuery(this).closest(".os-time-group").find(".ampm-value-hidden-holder").val(t),jQuery(this).closest(".quick-start-time-w").length&&(latepoint_set_booking_end_time(e),latepoint_is_next_day(e)),jQuery(this).closest(".quick-end-time-w").length&&latepoint_is_next_day(e),!1})),jQuery("body.latepoint-admin").on("click",".latepoint-lightbox-shadow",(function(){return latepoint_lightbox_close(),!1})),jQuery("body.latepoint-admin").on("click",".latepoint-side-panel-shadow",(function(){return jQuery(".latepoint-side-panel-w").remove(),!1})),jQuery("body.latepoint-admin").on("click",".ws-period-remove",(function(e){return jQuery(this).closest(".ws-period").remove(),!1})),jQuery(".latepoint-admin").on("click",".weekday-schedule-w .os-toggler",(function(e){return jQuery(this).hasClass("off")?jQuery(this).closest(".weekday-schedule-w").addClass("day-off").removeClass("is-editing").find("input.is-active").val(0):jQuery(this).closest(".weekday-schedule-w").removeClass("day-off").addClass("is-editing").find("input.is-active").val(1),!1}))}));